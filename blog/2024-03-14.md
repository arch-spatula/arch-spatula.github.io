---
title: "당신의 1억원짜리 취미 코딩"
authors: [arch-spatula]
tags: ["netlify", "vercel", "배포", "DDos"]
description: "호스팅 서비스 보안"
toc_max_heading_level: 6
---

# 당신의 1억원짜리 취미 코딩

화이트 데이입니다. 사탕은 없지만 DDoS는 줄 수 있는 있습니다.

<!-- 글쓰기 단계: invent -->

<!--truncate-->

회사에서 아주 가끔 작업이 끝나고 잠시 여유로울 때가 있습니다. 회사 슬랙방에 기술트렌드를 알려주는 봇이 있습니다. 거기서 이 글을 발견했습니다.

[Netlify가 간단한 정적 사이트에 대해 $104k(1억4천만원) 청구](https://news.hada.io/topic?id=13554)

회사 슬랙 방 봇이 추천한 글이고 기밀자료도 아닙니다. 링크 발견을 회사 슬랙방에서 발견했습니다. ~~뭐 유튜브 추천에서도 발견하고 크롬 브라우져에서 나중에 화장실에서 추천해줘도 K 법률답게 NDA(기밀유지협약)를 어겼군요.~~ 중요한 것은 이게 아니고 중요한 것은 비용 폭탄이 발생했다는 것입니다.

꽤나 화재가 되었습니다. 생각보다 많은 사람들이 빠르게 반응했습니다. 저의 의문은 저의 vercel로 올린 취미 프로젝트가 안전할까? 더이상 개발자가 취미로 개발하는게 저렴한 취미가 아닌가? 앞으로 취미로 만들면 배포를 AWS로 하고 직접 모두 설정해야 하는가?(이것도 취미로 언젠간 할 작업은 맞습니다.)

<iframe className="codepen" src="https://www.youtube.com/embed/NyCtO1bTWkY" title="당신도 DDoS 공격으로 나락에 갈 수 있다" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowFullScreen></iframe>

테크 인플루언서가 다룰 정도로 이슈가 되었습니다.

## 제일 먼저 스킬 이슈

사업을 운영하는 관점에서 보안이 취약하면 오히려 수익이 늘어난다면 최대한 보안을 취약하게 만들어야 하지 않는가? 제가 임원이고 이번 분기에 롱콜 옵션을 행사해야 하면 이런 행동을 할 것 같습니다. 저의 높은 직급으로 저연차 직원 계정을 도용하고 몇개 마음에 안 드는 고객사 MFA도 풀어고 해킹하고 비트코인 채굴하고 CDN이나 방화벽을 내려놓고 DDoS 공격을 합니다. 고객에게 비용 폭탄이 발생하게 만들었을 것입니다. 저연차는 짤리고 저는 높은 당기순이익을 반영하는 높아진 주가의 롱콜옵션을 행사할 것입니다. 이것이야 말로 이상 아닌가?

이번 사건의 피해자는 아마 그리고 그정도 상식도 없는가? 아마 없던 것 같습니다.

### 설정과 정의 문제

잘되는 서비스에서 트레픽이 늘어났는데 중단 되어야 하는가? 라는 질문을 누가 먼저 했습니다. 아니라는 것도 당연히 알고 있습니다. 아마 무엇이 맞고 틀리고에 대한 논박과정은 생략하고 이상적인 결론은 이렇다고 생각합니다. 설정 페이지에서 알아서 중단하는 토클 버튼있는 것입니다. 본인이 실제 서비스로 돈을 벌고자 한다면 토클을 끌 수 있게 설정할 것입니다. 뭐 이렇게 이상적이면 좋겠는데 세상이 언제 이상적인가? 대부분 특수한 경우만 이상적입니다. 아마 이번에는 DDoS 공격자 입장에서만 이상적일 것입니다.

엔지니어는 이상과 현실이 다르다는 것을 항상 자각해야 합니다. 법의 목적은 정의 실현이라고 생각하는가? 이런 질문을 진짜로 답하는 사람들은 법학자, 윤리학자, 철학자의 몫입니다. 개발자인 우리가 답하기 위한 시도는 오만합니다. 우리 위치에 맞지 않습니다. 하지만 굳이 답변하자면 아니라는 것을 바로 알 수 있습니다. 법의 목적은 사회 질서를 유지하기 위함입니다. 조금 생각해보면 이해가 될 것입니다. 왜 대기업 임원 고위직은 처벌하지 않는가? 오히려 질서 유지가 안되기 때문입니다. 주가는 폭락(~~가끔은 폭등~~)합니다. 회사 내부에서는 반란, 쿠데타 어쩌면 혁명이 발생할 수 있습니다. 그 사이 회사는 소비자 인식이 나빠지고 (a.k.a 브랜드 이미지에 타격을 입고) 시장 점유의 점유율을 잃을 수 있습니다. 이 말을 하는 이유는 세상 살면서 이상적으로 ~해야 한다는 이상과 실제로 ~하고 있는 현실은 다르다는 것입니다. 우리는 엔지니어입니다. 주어진 현실과 우리 위치를 아는 것이 기본입니다.

## vercel에 올린 저의 취미 프로젝트가 안전할까?

결론부터 이야기하면 오늘 시점으로는 어느정도 되어 있습니다. 하지만 궁극적으로는 모릅니다. 너무 환원주의적입니다. 보안은 늘 그렇듯 해커들은 늘 방법을 찾을 것입니다(hackers finds it's a way). 오늘 Vercel은 기본적인 방어 체계를 어느정도 마련해 놨을 것입니다. 하지만 언제 fuckup이 있을지 모르고 사용자인 우리탓을 할지 모릅니다.

Vercel은 저처럼 맥북 사용하고 스타벅스에서 VSCode로 Next.js React 코드짜는 코드 몽키들을 위해 기본 보안 장치를 마련했습니다. ~~앞으로 Vercel에 배포하면 개발자의 수치여기기 바랍니다.~~

github에 이런 이슈가 있었습니다. [What to do in case of DDoS attack?](https://github.com/vercel/next.js/discussions/41485) 기업 PR 다운 답변이 달렸습니다.

> Hey, wanted to follow up here.
>
> We just launched [Attack Challenge Mode](https://vercel.com/docs/security/attack-challenge-mode) –an extra layer of defense for DDoS and malicious traffic, free for all plans. When enabled, the Vercel Firewall will serve a challenge page to help mitigate attacks.
>
> \- Lee Robinson Vercel VP (Github 이슈에서 답변 중)

방화벽 계층이 가동하고 방화벽이 반환하는 페이지로 응답한다고 합니다. 이런 방식으로 공격을 방어한다고 합니다. 자세한 문서 탐구가 필요합니다.

### DDoS란 무엇인가?

DDoS랑 DoS란 무엇이 다른가? DoS는 특정 클라이언트가 서비스 리소스를 과도하게 점유하기 위해 요청하는 것입니다. DDoS는 앞에 Distributed가 붙습니다. 서비스를 과도하게 점유하기 위해 분산된 클라이언트를 갖고 공격을 감행하는 것입니다. 이 분산을 시키게 되면 방화벽 입장에서 한차원 더 복잡한 대응이 필요합니다. 만약에 IP가 같다면 10ms 내에 6회를 초과하는 요청을 요청을 보내는 클라이언트를 차단하도록 결정할 수 있을 것입니다. 하지만 DDoS로 봇넷이나 다른 탈취한 클라우드 계정으로 만든 분산된 클라이언트로 실제 트레픽을 흉내내도록 할 것입니다.

[Attack Challenge Mode](https://vercel.com/docs/security/attack-challenge-mode)라는 기능이 있습니다. 방화벽 가동입니다.

여기서 의문입니다. 방화벽이란 무엇인가?

네트워크 관점에서 방화벽의 기능은 동일한 IP의 동일한 요청을 차단하는 것으로 알고 있습니다. 그래서 최근 DDoS 공격 툴은 IP도 로테이션 돌고 유기적이게 보이게 만듭니다. 또 봇넷 팜을 운영하기도 합니다.

[Deployment Protection on Vercel](https://vercel.com/docs/security/deployment-protection)

[DDoS Mitigation](https://vercel.com/docs/security/ddos-mitigation)

문서를 살펴 보면 의심스러운 요청에 대해서 자동적으로 조정한다고 합니다.

1. 모니터링: 의심스러운 트래픽을 확인합니다.
2. 차단: DDoS라고 판단한 트래픽은 차단합니다.
3. 리소스 확대: DDoS 공격으로 서비스 장애가 발생하지 않게 자동적으로 키운다고 합니다.

무료 버전에 대해서 어느정도 보안하고자 하고 있습니다.

위 이슈에서 발견했습니다.

하지만 피곤해서 아직 안 읽었습니다.

공격자의 비용이 방어자의 비용이 더 높도록 설계하는 것이 방어의 시작입니다. 물론 상대가 이재용이면 그냥 포기합시다.

Surprise $104,500 Bill? Breaking Down A BIG Mistake

공격자는 정찰 방어자는 모니터

당신이 여자가 아닌 이상 스토커가 있을리가 없습니다. 일단 본인 이외 트렉픽 증가가 있으면 무조건 주시하고 의심하도록 합니다.

큰파일을 주의하도록 합니다. MB 단위 파일은 모두 더 최소화할 방법을 찾도록 합니다. Bandwidth를 잘 주의하도록 합니다.

### 방화벽이란 무엇인가?

## 방어 전략이란 무엇인가?

방어 전략은 공격자의 공격이 방어자의 방어보다 비용이 더 높으면 됩니다. 이렇게 되면 경제적 동기 없어 집니다. 마치 비밀번호는 결국 1억년 뒤에 뚤리기는 하는데 이미 사람이 죽어서 가치가 없고 또 1억년을 병렬 연산으로 땅겨도 해킹한 개인이 그만큼 돈이 없을 가능성이 높은 것이랑 비슷한 전략입니다.

CDN을 전방에 배치하는 것으로 부하를 분산시키는 것도 전략입니다. 이미 같은 요청이면 먼저 CDN 서버의 리소스를 접근하고 CDN 서버에서 반환하고 CDN에서 부하가 발생할 것입니다.

<iframe className="codepen" src="https://www.youtube.com/embed/U3fycWWA1tg" title="Two Weeks Of DDOS Attacks - Did We Survive?" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowFullScreen></iframe>

방어에 성공한 사람도 있습니다.

