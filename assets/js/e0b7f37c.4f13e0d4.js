"use strict";(self.webpackChunkarch_spatula_github_io=self.webpackChunkarch_spatula_github_io||[]).push([[3522],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>g});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=o.createContext({}),c=function(e){var n=o.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=c(e.components);return o.createElement(i.Provider,{value:n},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(t),m=r,g=p["".concat(i,".").concat(m)]||p[m]||u[m]||a;return t?o.createElement(g,l(l({ref:n},d),{},{components:t})):o.createElement(g,l({ref:n},d))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,l=new Array(a);l[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[p]="string"==typeof e?e:r,l[1]=s;for(var c=2;c<a;c++)l[c]=t[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},728:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var o=t(87462),r=(t(67294),t(3905));const a={title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",authors:["arch-spatula"],tags:["deno","mongoDB","error log"],description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",toc_max_heading_level:6},l="\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",s={permalink:"/blog/2023/05/25/",editUrl:"https://github.com/arch-spatula/arch-spatula.github.io/blob/dev/blog/2023-05-25.md",source:"@site/blog/2023-05-25.md",title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",date:"2023-05-25T00:00:00.000Z",formattedDate:"2023\ub144 5\uc6d4 25\uc77c",tags:[{label:"deno",permalink:"/blog/tags/deno"},{label:"mongoDB",permalink:"/blog/tags/mongo-db"},{label:"error log",permalink:"/blog/tags/error-log"}],readingTime:5.335,hasTruncateMarker:!0,authors:[{name:"arch-spatula",title:"Cook-Book \ub9ce\uc774 \ub9cc\ub4ed\ub2c8\ub2e4",url:"https://github.com/arch-spatula",imageURL:"https://github.com/arch-spatula.png",key:"arch-spatula"}],frontMatter:{title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",authors:["arch-spatula"],tags:["deno","mongoDB","error log"],description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",toc_max_heading_level:6},prevItem:{title:"\uc5d0\ub7ec\ub85c\uadf8: deno deploy\uc5d0\uc11c\ub294 Worker API\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.",permalink:"/blog/2023/05/27/"},nextItem:{title:"\ud1a0\ud070 \uc2f1\uae00\ud2bc",permalink:"/blog/2023/05/23/token-singleton"}},i={authorsImageUrls:[void 0]},c=[{value:"\ubb38\uc81c: Connection was forcibly closed by a peer",id:"\ubb38\uc81c-connection-was-forcibly-closed-by-a-peer",level:2},{value:"\uc2dc\ub3c4: MongoAPI\uac00 \ubb38\uc81c\uc778\uac00?",id:"\uc2dc\ub3c4-mongoapi\uac00-\ubb38\uc81c\uc778\uac00",level:2},{value:"\uac00\uc124: MongoAPI \uba54\uc11c\ub4dc\uc5d0 \ubb38\uc81c\uac00 \uc788\uc2b5\ub2c8\ub2e4.",id:"\uac00\uc124-mongoapi-\uba54\uc11c\ub4dc\uc5d0-\ubb38\uc81c\uac00-\uc788\uc2b5\ub2c8\ub2e4",level:3},{value:"\uac31\uc2e0\uc740 \uc815\uc0c1\ub3d9\uc791",id:"\uac31\uc2e0\uc740-\uc815\uc0c1\ub3d9\uc791",level:3},{value:"\uac00\uc124: DB \uc11c\ubc84 \ubcf4\uc548\ubb38\uc81c",id:"\uac00\uc124-db-\uc11c\ubc84-\ubcf4\uc548\ubb38\uc81c",level:3},{value:"\ud574\uacb0: Deno oak\uc5d0\uc11c delete\uc758 response body\ub294 null\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.",id:"\ud574\uacb0-deno-oak\uc5d0\uc11c-delete\uc758-response-body\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",level:2},{value:"\ud559\uc2b5: deno oak\uc5d0\uc11c delete\uc758 <code>response.body</code>\ub294 <code>null</code>\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.",id:"\ud559\uc2b5-deno-oak\uc5d0\uc11c-delete\uc758-responsebody\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",level:2},{value:"\ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\uc5ed",id:"\ubc31\uc5d4\ub4dc-\uc5d4\uc9c0\ub2c8\uc5b4\uc758-\uace0\uc5ed",level:2}],d={toc:c},p="wrapper";function u(e){let{components:n,...t}=e;return(0,r.kt)(p,(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\ud639\uc2dc\ub098 \ud588\ub294\ub370 \uc5ed\uc2dc\ub098 \uacaa\uc740 \ubb38\uc81c\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"tl;dr : deno oak\uc5d0\uc11c delete\uc758 ",(0,r.kt)("inlineCode",{parentName:"p"},"response.body"),"\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ubb38\uc81c-connection-was-forcibly-closed-by-a-peer"},"\ubb38\uc81c: Connection was forcibly closed by a peer"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\uc11c\ubc84\ub97c \uad6c\ub3d9\ud558\uace0 \uc0ad\uc81c\uc694\uccad\uc744 \ubcf4\ub0b4\uba74 ",(0,r.kt)("inlineCode",{parentName:"li"},"Connection was forcibly closed by a peer"),"\uc774\ub77c\uace0 \uc751\ub2f5\ud569\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"Connection was forcibly closed by a peer")," \uc751\ub2f5\uc744 \ubc1b\uc740 \uc774\ud6c4\ubd80\ud130\ub294 MongoDB Atlas\uc5d0\uc11c\ub294 \ub2e4\ub978 \uc694\uccad\uc744 \uac70\ubd80\ud569\ub2c8\ub2e4.")),(0,r.kt)("h2",{id:"\uc2dc\ub3c4-mongoapi\uac00-\ubb38\uc81c\uc778\uac00"},"\uc2dc\ub3c4: MongoAPI\uac00 \ubb38\uc81c\uc778\uac00?"),(0,r.kt)("h3",{id:"\uac00\uc124-mongoapi-\uba54\uc11c\ub4dc\uc5d0-\ubb38\uc81c\uac00-\uc788\uc2b5\ub2c8\ub2e4"},"\uac00\uc124: MongoAPI \uba54\uc11c\ub4dc\uc5d0 \ubb38\uc81c\uac00 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { config } from 'https://deno.land/x/dotenv@v3.2.2/mod.ts';\nimport CardRecord from '../model/cards.ts';\n\nclass MongoAPI {\n  async deleteCards($oid: string) {\n    try {\n      const result = await fetch(`${this.baseURL}/deleteOne`, {\n        ...this.options,\n        body: JSON.stringify({\n          ...this.cardBody,\n          filter: { _id: { $oid } },\n        }),\n      });\n      return result.json();\n    } catch (error) {\n      return error;\n    }\n  }\n}\n\ntry {\n  const mongoAPI = MongoAPI.getInstance();\n  console.log(await mongoAPI.deleteCards('\uc5b4\ub5a4 id'));\n} catch (error) {\n  console.log(error);\n}\n")),(0,r.kt)("p",null,"MongoAPI\uc5d0\uc11c \uc0ad\uc81c \ubaa8\ub4c8\ub97c \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ud588\ub294\ub370 \ubb38\uc81c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uac31\uc2e0\uc740-\uc815\uc0c1\ub3d9\uc791"},"\uac31\uc2e0\uc740 \uc815\uc0c1\ub3d9\uc791"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"async function updateCard(ctx: Context) {\n  const { request, response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    if (!request.hasBody) throw Error('No Data');\n\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    const userId = await token.tokenToUserId(jwt);\n    if (!userId) throw Error('\uc0ac\uc6a9\uc790 id\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    const { question, answer, submitDate, stackCount } = await request.body()\n      .value;\n    if (!question || !answer || !submitDate || !stackCount)\n      throw Error('question, answer, data, stackCount \uc911 \uac12\uc774 1\uac1c \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    const card = new CardRecord(\n      question,\n      answer,\n      submitDate,\n      stackCount,\n      userId,\n      id\n    );\n\n    response.status = 200;\n    response.body = await mongoAPI.patchCards(card);\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n")),(0,r.kt)("p",null,"\uac31\uc2e0\uc740 body\uac00 \ud544\uc694\ud55c\ub370 \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc delete\ub294 body\uac00 \ub531\ud788 \ud544\uc694\ud55c \uba54\uc11c\ub4dc\ub294 \uc544\ub2d9\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"async function deleteCard(ctx: Context) {\n  const { response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    const userId = await token.tokenToUserId(jwt);\n    if (!userId) throw Error('\uc0ac\uc6a9\uc790 id\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    response.status = 204;\n    response.body = await mongoAPI.deleteCards(id);\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n")),(0,r.kt)("h3",{id:"\uac00\uc124-db-\uc11c\ubc84-\ubcf4\uc548\ubb38\uc81c"},"\uac00\uc124: DB \uc11c\ubc84 \ubcf4\uc548\ubb38\uc81c"),(0,r.kt)("p",null,"\uac00\uc124: \ubcf4\uc548\ubb38\uc81c\ub85c \ud2b9\uc815 \uc694\uccad\uc5d0 \ub300\ud574\uc11c \uc124\uc815\uc744 \ud480\uc5b4\uc918\uc57c \ud55c\ub2e4."),(0,r.kt)("p",null,"\ud558\uc9c0\ub9cc DB \uc11c\ubc84\uc5d0\uc11c \ubcf4\uc548\ubb38\uc81c\uac00 \uc788\uc5c8\uc73c\uba74 \ub3c5\ub9bd\uc801\uc778 \ubaa8\ub4c8\ub85c \ud1b5\uc2e0\ud560 \ub54c\ubd80\ud130 \uc694\uccad \uac70\uc808\uc774 \ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ubb38\uc81c\uac00 \uc5c6\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ud574\uacb0-deno-oak\uc5d0\uc11c-delete\uc758-response-body\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4"},"\ud574\uacb0: Deno oak\uc5d0\uc11c delete\uc758 response body\ub294 null\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"async function deleteCard(ctx: Context) {\n  const { response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    response.status = 204;\n    const msg = await mongoAPI.deleteCards(id);\n    console.log(msg);\n    response.body = null;\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n")),(0,r.kt)("p",null,"\uc774\ub807\uac8c \uc791\uc131\ud558\ub2c8\uae4c \ud574\uacb0\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc989 ",(0,r.kt)("inlineCode",{parentName:"p"},"response.body = null"),"\ub85c \uc791\uc131\ud558\uba74 \uc0ad\uc81c \uad6c\ud604\uc774 \ub429\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ud559\uc2b5-deno-oak\uc5d0\uc11c-delete\uc758-responsebody\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4"},"\ud559\uc2b5: deno oak\uc5d0\uc11c delete\uc758 ",(0,r.kt)("inlineCode",{parentName:"h2"},"response.body"),"\ub294 ",(0,r.kt)("inlineCode",{parentName:"h2"},"null"),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"deno oak\uc5d0\uc11c delete\uc758 ",(0,r.kt)("inlineCode",{parentName:"li"},"response.body"),"\ub294 ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},"\ub514\ubc84\uae45\ud560 \ub54c\ub294 \uae30\ub85d\ud558\uba74\uc11c \uac00\uc124\uc744 \uc798 \uc124\uc815\ud558\uba74 \ud6a8\uc728\uc801\uc785\ub2c8\ub2e4. \ubb34\uc5c7\uc774 \uc544\ub2cc\uc9c0 \uc18c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uace0\uae09\uc2a4\ub7ec\uc6b4 \ud45c\ud604\uc744 \uc0ac\uc6a9\ud558\uba74 \ubc84\uadf8 \ubc1c\uc6d0\uc9c0\uc758 \uba74\uc801\uc744 \ucd95\uc18c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("li",{parentName:"ol"},"\uc5d0\ub7ec\uba54\uc2dc\uc9c0\ub294 \uccab\uc904\uc5d0 \ud56d\uc0c1 \uc8fc\uc758\ud569\uc2dc\ub2e4.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"[uncaught application error]",": TypeError - Response with null body status cannot have body")),(0,r.kt)("p",null,"\uc774\ub7f0 \uba54\uc2dc\uc9c0\ub97c \ubd24\ub294\ub370 \ub098\uc911\uc5d0 \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ubc31\uc5d4\ub4dc-\uc5d4\uc9c0\ub2c8\uc5b4\uc758-\uace0\uc5ed"},"\ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\uc5ed"),(0,r.kt)("p",null,"\ud30c\uc77c\uc744 \ubcc0\uacbd\ud558\uace0 API\ub97c \uba54\ub274\uc5bc \ud14c\uc2a4\ud2b8\ud560 \ub54c cookie\ub97c \uc0c8\ub85c \ub9cc\ub4e4\uc5b4\uc57c \ud55c\ub2e4\ub294 \ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\ud1b5\uc744 \uacf5\uac10\ud560 \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. \uc694\uccad\uc751\ub2f5 \uc2dc\uac04\uc774 3\ucd08\ub9cc \ub118\uaca8\ub3c4 \uc5c4\uccad\ub09c \uc138\uc6d4\uc774 \ud750\ub978 \ub290\ub08c\uc774\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ub2e4\ub978 \uace0\uc5ed\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \ucf54\ub4dc \uc791\uc131\uc785\ub2c8\ub2e4. Deno\ub97c \ud14c\uc2a4\ud2b8\ud558\ub294 \ubc29\ubc95\uc774 \uc775\uc219\ud558\uc9c0 \uc54a\uc544\uc11c \uadf8\ub7f0 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \uc775\uc219\ud574\uc9c0\uba74 \uc27d\uac8c \ud574\uacb0\ud560 \uc218 \uc788\uc744 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \uc77c\ubd80 \ub3d9\uc791\ud558\ub294 \ud14c\uc2a4\ud2b8\ub3c4 \uc788\uc9c0\ub9cc \uc77c\ubd80 \uc791\uc131\uc5d0 \uc2e4\ud328\ud55c \ud14c\uc2a4\ud2b8\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\ub978 \ud504\ub85c\uc81d\ud2b8 \uc9c4\ud589\ud558\uba74\uc11c \ud559\uc2b5\ud560 \uc218 \uc788\uc744 \uac83 \uac19\uc2b5\ub2c8\ub2e4."))}u.isMDXComponent=!0}}]);