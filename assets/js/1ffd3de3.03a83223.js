"use strict";(self.webpackChunkarch_spatula_github_io=self.webpackChunkarch_spatula_github_io||[]).push([[23413],{26633:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var s=r(85893),t=r(11151);const o={sidebar_position:1},i="Nest.js",a={id:"index",title:"Nest.js",description:"https://namu.wiki/w/NestJS",source:"@site/nestjs/index.md",sourceDirName:".",slug:"/",permalink:"/nestjs/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"Nest.js\uc640 Nest.js \uc0dd\ud0dc\uacc4\uc5d0 \ub300\ud55c \uc9c8\ubb38 100\uac00\uc9c0",permalink:"/nestjs/qna-100"}},c={},l=[{value:"local import",id:"local-import",level:3},{value:"global import",id:"global-import",level:3},{value:"\ud68c\uc6d0\uac00\uc785 \ub85c\uc9c1 \ucc98\ub9ac\ud558\uae30",id:"\ud68c\uc6d0\uac00\uc785-\ub85c\uc9c1-\ucc98\ub9ac\ud558\uae30",level:3},{value:"\ube44\ubc00\ubc88\ud638 \ud574\uc26c\ud558\uae30",id:"\ube44\ubc00\ubc88\ud638-\ud574\uc26c\ud558\uae30",level:3},{value:"\ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30",id:"\ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30",level:3},{value:"\ub85c\uadf8\uc778 \ucc98\ub9ac\ud558\uae30",id:"\ub85c\uadf8\uc778-\ucc98\ub9ac\ud558\uae30",level:3},{value:"DB &amp; \ud504\ub9ac\uc988\ub9c8 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc790\ub3d9\ud654",id:"db--\ud504\ub9ac\uc988\ub9c8-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uc790\ub3d9\ud654",level:3},{value:"config module",id:"config-module",level:3},{value:"JWT \uc778\uc99d, \uc778\uac00",id:"jwt-\uc778\uc99d-\uc778\uac00",level:3},{value:"guards",id:"guards",level:2},{value:"custom param decorator",id:"custom-param-decorator",level:2},{value:"e2e tests with pactumJs",id:"e2e-tests-with-pactumjs",level:2},{value:"Prisma database teardown logic",id:"prisma-database-teardown-logic",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"nestjs",children:"Nest.js"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://namu.wiki/w/NestJS",children:"https://namu.wiki/w/NestJS"})}),"\n",(0,s.jsx)(n.p,{children:"\ub098\ubb34\uc704\ud0a4\ub3c4 \uc2e0\uae30\ud558\uac8c \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=GHTA143_b-s&t=82s",children:"https://www.youtube.com/watch?v=GHTA143_b-s&t=82s"})}),"\n",(0,s.jsx)(n.p,{children:"express\uc758 \ub2e8\uc810\uc740 \uc544\ud0a4\ud14d\uccd0\ubb38\uc81c\uc785\ub2c8\ub2e4. \uc5b4\ub5bb\uac8c \uad6c\uc870\ud654\ud574\uc57c \ud560\uc9c0 \uc758\uacac\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. Nest.js\ub294 \uc758\uacac\uc744 \uac16\uace0 \uc5b4\ub5bb\uac8c \uad6c\ud604\ud574\uc57c \ud558\ub294\uc9c0 \uc544\ud0a4\ud14d\uccd0\ub97c \uad6c\uc131\ud560\uc9c0 \uc555\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"Nest.js\ub294 \ubc31\uc5d4\ub4dc \uc575\uade4\ub7ec\ub77c\ub294 \ubcc4\uba85\uc744 \uac16\uace0 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uad6c\uc870\ud654, \ubaa8\ub4c8\ud654, \ud0c0\uc785\uc2a4\ud06c\ub9bd\u314c, \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \ub4f1 \ub2e4\uc591\ud55c \uc7a5\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"express \ub2e4\uc74c\uc73c\ub85c \uc81c\uc77c \uc778\uae30\uac00 \ub9ce\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc544\ud0a4\ud14d\uccd0 \uad6c\uc870\uac00 \ub2e4 \uacb0\uc815\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 \uae30\uc5c5\uc785\uc7a5\uc5d0\uc11c \uad50\uc721\ube44\uc6a9\uc774 \ub0ae\uc740 \ud3b8\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npm i -g @nestjs/cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc804\uc5ed\uc73c\ub85c \uc124\uce58\ud560 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest new project-name\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"app.module.ts"}),"\uc740 \ub2e4\ub978 \ubaa8\ub4c8\uc774 \ubaa8\uc77c \ud30c\uc77c\uc785\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="app.module.ts"',children:"import { Module } from '@nestjs/common';\n\n@Module({\n  imports: [],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/",children:"https://docs.nestjs.com/"})}),"\n",(0,s.jsx)(n.p,{children:"Module\uc740 controller\uc640 provider\ub97c \ubc1b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uae30\ub2a5\ub2e8\uc704\ub85c \ucabc\uac24 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"auth, todo, user \ucc98\ub7fc \ubd84\ub9ac\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \ubaa8\ub4c8\uae30\uc900\uc73c\ub85c \uc571\uc744 \uc815\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc791\uc740 \ud558\uc704 \ubaa8\ub4c8\uc744 \ubd84\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ucee8\ubca4\uc158\uc740 \ubaa8\ub4c8\uc744 \ub9cc\ub4e4 \ub54c\ub9c8\ub2e4 \ud3f4\ub354\ub97c \ub9cc\ub4e4\uc5b4\uc57c \ud569\ub2c8\ub2e4. app.module.ts\ub9cc \uc0c1\uc704\uc5d0\uc11c \uc608\uc678\ub85c \ub461\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.module.ts"',children:"import { Module } from '@nestjs/common';\n\n@Module({\n  imports: [],\n})\nexport class Auth {}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn run start\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc740 \uc2dc\uc791\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn start dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uac1c\ubc1c\uc11c\ubc84 \uc2dc\uc791\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest g module user\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\ubaa8\ub4c8 \uc790\ub3d9\uc0dd\uc131\uc785\ub2c8\ub2e4. ",(0,s.jsx)(n.code,{children:"app.module.ts"}),"\uc5d0 \uc790\ub3d9\ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Module } from '@nestjs/common';\nimport { AuthModule } from './auth/auth.module';\nimport { UserModule } from './user/user.module';\nimport { BookmarkModule } from './bookmark/bookmark.module';\n\n@Module({\n  imports: [AuthModule, UserModule, BookmarkModule],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uacf5\uc2dd \ubb38\uc11c\uc5d0\uc11c \ucee8\ud2b8\ub864\ub7ec\ub294 \uc694\uccad\uc744 \ucc98\ub9ac\ud558\uace0 \uc751\ub2f5\ud558\ub294 \ucc45\uc784\uc744 \uac16\ub294\ub2e4\uace0 \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"Provider\ub294 \ube44\uc988\ub2c8\uc2a4\ub85c\uc9c1\uc744 \ucc98\ub9ac\ud558\ub294 \ucc45\uc784\uc744 \uac16\uace0 \uc788\ub2e4\uace0 \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.controller.ts"',children:"import { Controller } from '@nestjs/common';\n\n@Controller()\nexport class AuthController {}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.service.ts"',children:"import { Injectable } from '@nestjs/common';\n\n@Injectable({})\nexport class AuthService {}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\n\n@Module({\n  imports: [],\n  controllers: [AuthController],\n  providers: [AuthService],\n})\nexport class AuthModule {}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup() {\n    return 'sign up';\n  }\n\n  @Post('signin')\n  signin() {\n    return 'sign in';\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"http://localhost:3000/auth/signup\n"})}),"\n",(0,s.jsx)(n.p,{children:"post \uc694\uccad\uc744 \ud558\uba74 sign up \uc751\ub2f5\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc9c0\uae08\uc740 \ubb38\uc790\uc5f4\uc778\ub370 \uc751\ub2f5\uc744 \uac1d\uccb4\uac19\uc740 \ucc38\uc870\ud615\uc73c\ub85c \uc751\ub2f5\ud574\ub3c4 \uc54c\uc544\uc11c json\uc73c\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup() {\n    return { mas: 'good' };\n  }\n\n  @Post('signin')\n  signin() {\n    return 'sign in';\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc694\uccad\uc751\ub2f5\ucc98\ub9ac\ub294 controller\uac00 \ucc98\ub9ac\ud569\ub2c8\ub2e4. \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc740 service\uc5d0\uc11c \ucc98\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.service.ts"',children:"import { Injectable } from '@nestjs/common';\n\n@Injectable({})\nexport class AuthService {\n  login() {\n    return { msg: 'good' };\n  }\n\n  signup() {\n    return { msg: 'fuiyoh' };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.controller.ts"',children:"import { Controller, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup() {\n    return this.authService.signup();\n  }\n\n  @Post('signin')\n  signin() {\n    return this.authService.login();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub294 \uac1d\uccb4\uc640 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \ucc98\ub9ac\ud558\ub294 \uad00\uc2ec\uc0ac\uac00 \ubd84\ub9ac\ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc694\uccad\uacfc \ube44\uc988\ub2c8\uc2a4\ub85c\uc9c1\uc744 \ubd84\ub9ac\ud574\uc11c \ube44\uc988\ub2c8\uc2a4\ub85c\uc9c1\uc5d0 \ub354 \uc9d1\uc911\ud558\ub294 \uc804\ub7b5\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"version: '3.8'\nservices:\n  dev-db:\n    image: postgres:13\n    ports:\n      - 5434:5432\n    environment:\n      - POSTGRES_USER:postgres\n      - POSTGRES_PASSWORD:123\n      - POSTGRES_DB:nest\n    networks:\n      - freecodecamp\nnetworks:\n  freecodecamp:\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc744 \ud65c\uc6a9\ud558\ub2c8\uae4c \ub3d9\uc791\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"version: '3.8'\nservices:\n  dev-db:\n    image: postgres:13\n    ports:\n      - 5434:5432\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=123\n      - POSTGRES_DB=nest\n    networks:\n      - freecodecamp\nnetworks:\n  freecodecamp:\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839 \ud30c\uc77c\ub85c \uba85\ub839\ud558\ub2c8\uae4c \ub3d9\uc791\ud588\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ucc38\uace0\ub85c \ub3d9\uc791\ud558\uac8c \uba85\ub839\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker compose up dev-db -d\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker ps\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc744 \ub3d9\uc791\ud558\ub294 \ud504\ub85c\uc138\uc2a4\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(n.p,{children:["\uc5b4\ub5a4 ",(0,s.jsx)(n.code,{children:"CONTAINER ID"}),"\ub97c \uba85\ub839\uc5d0 \ud65c\uc6a9\ud558\uba74 \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker logs (CONTAINER_ID)\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uba85\ub839\ud558\uba74 \ud574\ub2f9 \ucee8\ud14c\uc774\ub108\uc758 \ud130\ubbf8\ub110 \ub85c\uadf8\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud504\ub9ac\uc988\ub9c8\ub294 \ucffc\ub9ac\ube4c\ub354\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud504\ub9ac\uc988\ub9c8 cli\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ud504\ub9ac\uc988\ub9c8 client 2\uac1c\ub97c \uc124\uce58\ud574\uc57c \ud65c\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add -D prisma # CLI\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add @prisma/client # Client\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx prisma init\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud504\ub9ac\uc988\ub9c8 \ud30c\uc77c\uc744 \ub9cc\ub4e4\uc5b4\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:'// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = "prisma-client-js"\n}\n\ndatasource db {\n  provider = "postgresql"\n  url      = env("DATABASE_URL")\n}\n\nmodel User{\n  id Int @id @default(autoincrement())\n  createAt DateTime @default(now())\n  updateAt DateTime @updatedAt\n  email String\n  hash String\n  salt String\n  firstName String?\n  lastName String?\n}\n\nmodel Bookmark{\n  id Int @id @default(autoincrement())\n  createAt DateTime @default(now())\n  updateAt DateTime @updatedAt\n  title String\n  description String?\n  link String\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc544\uae4c\ub9cc\ub4e0 docker \ud30c\uc77c\uc744 \ubcf4\uba74 \ud658\uacbd\ubcc0\uc218\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc774 \uc124\uc815\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'DATABASE_URL="postgresql://johndoe:randompassword@localhost:5432/mydb?schema=public" # \ud504\ub9ac\uc988\ub9c8\ub85c \ubc1b\uc740 \uc815\ubcf4\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'DATABASE_URL="postgresql://postgres:123@localhost:5434/nest?schema=public" # \uc124\uc815\ud560 \ud658\uacbd\ubcc0\uc218\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx prisma migrate dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub984\uc744 \uc815\ud574\uc8fc\uae30\ub294 \ud574\uc57c\ud569\ub2c8\ub2e4. \ud504\ub85c\ub355\uc158 \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc740 \ub530\ub85c \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx prisma generate\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud504\ub9ac\uc988\ub9c8\uc5d0 \uc815\uc758\ud55c DB\uc758 \ud0c0\uc785\uc744 \ud0c0\uc785\uc2a4\ud06c\ub9bd\ud2b8\uc5d0 \ud65c\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx prisma studio\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ube0c\ub77c\uc6b0\uc800\uc5d0 DB\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud504\ub9ac\uc988\ub9c8\uc640 postgres SQL\uc744 \uc124\uc815\ud558\uace0 \ub098\uba74 \uc774\uc81c DB\uc5d0 \uc5f0\uacb0\ud558\ub294 \uc791\uc5c5\uc774 \ub0a8\uc558\uc2b5\ub2c8\ub2e4. Nest.js\uc5d0 \ubaa8\ub4c8\uc5d0 \uc704\uc784\ud574\uc11c \ucc98\ub9ac\ud558\ub294 \uac83 \uc88b\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest g module prisma\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest g service prisma --no-spec\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ucc38\uace0\ub85c spec\uc740 \uc694\uad6c\uc0ac\ud56d \uc989 \ud14c\uc2a4\ud2b8\ucf54\ub4dc\ub97c \uc791\uc131\ud558\ub294 \ud30c\uc77c\ub3c4 \uc790\ub3d9 \uc0dd\uc131\ud574\uc90d\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud50c\ub808\uadf8 \uc124\uc815\ud558\uba74 \uc790\ub3d9\uc0dd\uc131\uc740 \uc548 \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title=/prisma.service.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { PrismaClient } from '@prisma/client';\nimport { env } from 'process';\n\n@Injectable()\nexport class PrismaService extends PrismaClient {\n  constructor() {\n    super({ datasources: { db: { url: env.DATABASE_URL } } });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud655\uc778\uc744 \uc704\ud574 npx prisma studio\uc73c\ub85c \ube0c\ub77c\uc6b0\uc800\ub97c \ud655\uc778\ud558\uace0 \uc11c\ubc84\ub97c \uac00\ub3d9\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"local-import",children:"local import"}),"\n",(0,s.jsx)(n.p,{children:"\uc11c\ube44\uc2a4 \ub85c\uc9c1\uc744 \ucc98\ub9ac\ud558\ub294 \uac83\uc744 \uac01\uac01 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc8fc\uc785\ubc1b\uac8c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="prisma.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\n\n@Module({\n  providers: [PrismaService],\n  exports: [PrismaService], // \uc811\uadfc \uac00\ub2a5\ud558\uac8c \ucc98\ub9ac\n})\nexport class PrismaModule {}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\nimport { PrismaModule } from 'src/prisma/prisma.module';\n\n@Module({\n  imports: [PrismaModule],\n  controllers: [AuthController],\n  providers: [AuthService],\n})\nexport class AuthModule {}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.service.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\n\n@Injectable({})\nexport class AuthService {\n  constructor(private prisma: PrismaService) {}\n  login() {\n    return { msg: 'good' };\n  }\n\n  signup() {\n    return { msg: 'fuiyoh' };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uc811\uadfc\uac00\ub2a5\ud574\uc9d1\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc758\uc874\uc131\uc744 \uc8fc\uc785\ud560 \ub54c \uc8fc\uc785\uc758 \uc8fc\uccb4\uc5d0\uc11c\ub3c4 \uc8fc\uc785\ud560\uc9c0 \ub9d0\uc9c0 export \uc124\uc815\uc744 \ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uc11c\ube44\uc2a4\ub07c\ub9ac \uacf5\uc720\ud558\uae30 \uc704\ud574\uc11c\ub294 module\uc5d0\uc11c \uba3c\uc800 \ubc1b\uc544\uc57c service\uc5d0\uc11c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc \ud558\uc704 \uad6c\uccb4\uc801\uc778 \uc758\uc874\uc131\uc774\uba74 \uc801\ud569\ud558\uc9c0\ub9cc \ub2e4\uc591\ud55c module\uc5d0 \uacf5\uc720\uac00 \ud544\uc694\ud558\ub2e4\uba74 \ube44\ud6a8\uc728\uc801\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"global-import",children:"global import"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="prisma.module.ts"',children:"import { Global, Module } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\n\n@Global()\n@Module({\n  providers: [PrismaService],\n  exports: [PrismaService],\n})\nexport class PrismaModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc124\uc815\ud558\uba74 \uc804\uc5ed\uc73c\ub85c \uacf5\uc720\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="app.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthModule } from './auth/auth.module';\nimport { UserModule } from './user/user.module';\nimport { BookmarkModule } from './bookmark/bookmark.module';\nimport { PrismaModule } from './prisma/prisma.module';\n\n@Module({\n  imports: [AuthModule, UserModule, BookmarkModule, PrismaModule],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ub8e8\ud2b8 \ubaa8\ub4c8\uc5d0\ub3c4 \uacf5\uc720\ud558\ub294 \uac83\uc744 \uc78a\uc9c0\ub9d0\ub3c4\ub85d \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"nest.js\ub294 \uc124\uc815\uc791\uc5c5\uc744 \ub9ce\uc774 \uac04\uc18c\ud558\uac8c \ud574\uc90d\ub2c8\ub2e4. \uc775\uc219\ud574\uc9c0\uae30\ub9cc \ud558\uba74 \uc77c\uad00\ub41c \uad6c\uc870\ub97c \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c\ubd80\ud130 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \ucc98\ub9ac\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"\ud68c\uc6d0\uac00\uc785-\ub85c\uc9c1-\ucc98\ub9ac\ud558\uae30",children:"\ud68c\uc6d0\uac00\uc785 \ub85c\uc9c1 \ucc98\ub9ac\ud558\uae30"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.controller.ts"',children:"import { Controller, Post, Req } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { Request } from 'express';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup(@Req() req: Request) {\n    console.log(req);\n    return this.authService.signup();\n  }\n\n  @Post('signin')\n  signin() {\n    return this.authService.login();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"express\ub97c \uc774\ub807\uac8c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc694\uccad\uc758 \uc815\ubcf4\ub97c \ubc1b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc11c nest.js\ub294 \uc5ec\ub7ec\uac00\uc9c0 \uac80\uc99d \ub3c4\uad6c\ub4e4\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"Nest.js\ub294 DTO\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ucc38\uace0\ub85c Nest.js\uc5d0\uc11c express\uc774\ub807\uac8c \uc9c1\uc811 \uc811\uadfc\ud558\uace0 \ud65c\uc6a9\ud558\ub294 \uac83\uc740 \uad8c\uc7a5\ud558\uc9c0 \uc54a\ub294 \ud328\ud134\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.module.ts"',children:"import { Body, Controller, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { Request } from 'express';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup(@Body() dto: any) {\n    console.log({ dto });\n    return this.authService.signup();\n  }\n\n  @Post('signin')\n  signin() {\n    return this.authService.login();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c @Body\ub97c \ud65c\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud3f4\ub354\uc758 \uacc4\uce35 \uad6c\uc870\ub294 dto\ub97c \uac01\uac01\uc758 module\uacfc \ub300\uc751\ud574\uc11c \uc815\ub9ac\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth/dto/auth.dto.ts"',children:"export interface AuthDto {\n  email: string;\n  password: string;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth/dto/index.ts"',children:"export * from './auth.dto';\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.controller.ts"',children:"import { Body, Controller, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { AuthDto } from './dto';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup(@Body() dto: AuthDto) {\n    console.log({ email: dto.email, password: dto.password });\n    return this.authService.signup();\n  }\n\n  @Post('signin')\n  signin() {\n    return this.authService.login();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud0c0\uc785\uc9c0\uc815\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "email": "email@email.com",\n  "password": "qwer1234"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\ud574\ub2f9\ud558\ub294 body\uc758 \uc720\ud6a8\uc131\uc744 \uac80\uc99d\ud574\uc57c \ud569\ub2c8\ub2e4. \ub9cc\uc57d\uc5d0 body\uc5d0 \uc800\ub7f0 \ubc29\ubc95\uc73c\ub85c \uc548 \ub118\uaca8\uc92c\ub2e4\uba74 \uc5b4\ub5bb\uac8c \ub418\uc5c8\uc744 \uac83\uc778\uac00?"}),"\n",(0,s.jsx)(n.p,{children:"\uc544\ub9c8 \uc11c\ubc84\ub294 \uc774\uc0c1\ud558\uac8c \ucc98\ub9ac\ud560 \uac83\uc785\ub2c8\ub2e4. \ub85c\uc9c1\uc744 \uc9c1\uc811 \uc791\uc131\ud560 \uc218 \uc788\uc9c0\ub9cc \uaf64 \ub9ce\uc740 \uc0ac\ub78c\ub4e4\uc774 \uc790\uc8fc \uacaa\uc740 \ubb38\uc81c\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub54c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uac83\uc740 pipe\uc785\ub2c8\ub2e4. pipe\uc740 nest.js\uc5d0\uc11c \ub370\uc774\ud130\ub97c \ubcc0\ud658\ud558\ub294 \ud568\uc218\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Body, Controller, ParseIntPipe, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { AuthDto } from './dto';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup(\n    @Body('email') email: string,\n    @Body('password', ParseIntPipe) password: string\n  ) {\n    console.log({ email: email, password: password });\n    return this.authService.signup();\n  }\n\n  @Post('signin')\n  signin() {\n    return this.authService.login();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "email": "email@email.com",\n  "password": "qwer1234"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uc2e4\ud328\ud558\uace0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "email": "email@email.com",\n  "password": "1234"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uc131\uacf5\ud569\ub2c8\ub2e4. \uc22b\uc790\ub85c \ubcc0\ud615\ub3c4 \uc790\ub3d9\uc73c\ub85c \ud574\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc \uc774\ub807\uac8c \uc791\uc131\ud558\uba74 verbose\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"pipe\ub294 \ub0b4\ubd80\uc801\uc73c\ub85c \uc774\ub807\uac8c \ub3d9\uc791\ud55c\ub2e4\ub294 \uac83\uc744 \ubc30\uc6e0\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c\ub294 DTO \ucc28\uc6d0\uc5d0\uc11c \uc54c\uc544\uc11c \uc720\ud6a8\uc131 \uac80\uc0ac\ud558\ub3c4\ub85d \ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add class-validator class-transformer\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uba3c\uc800 \uc704 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc124\uce58\ud574\uc57c \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth/dto/auth.dto.ts"',children:"import { IsEmail, IsNotEmpty, IsString } from 'class-validator';\n\nexport class AuthDto {\n  @IsEmail()\n  @IsNotEmpty()\n  email: string;\n\n  @IsString()\n  @IsNotEmpty()\n  password: string;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ub300\uc18c\ubb38\uc790 \uad6c\ubd84\uc744 \uc870\uc2ec\ud558\uae30 \ubc14\ub78d\ub2c8\ub2e4. \uc18c\ubb38\uc790 \ub300\ubb38\uc790 \ubaa8\ub450 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="main.ts"',children:"import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { ValidationPipe } from '@nestjs/common';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.useGlobalPipes(new ValidationPipe());\n  await app.listen(3000);\n}\nbootstrap();\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"app.useGlobalPipes(new ValidationPipe());"}),"\uae4c\uc9c0 \uc124\uc815\ud558\ub294 \uac83\uc77c \uc78a\uc9c0\ub9d0\ub3c4\ub85d \ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc124\uc815\ud558\uba74 DTO\uc5d0\uc11c \uc720\ud6a8\uc131\uc744 \ub300\uc2e0 \uac80\uc99d\ud574\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \uc57d\uac04\uc758 \ubcf4\uc548\uc5d0\uc11c\ub3c4 \uc88b\uc740 \uc124\uc815\ub3c4\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="main.ts"',children:"import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { ValidationPipe } from '@nestjs/common';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n  await app.listen(3000);\n}\nbootstrap();\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "email": "email@email.com",\n  "password": "1234",\n  "stop": "drop and roll"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ub370\uc774\ud130\ub97c \ubcf4\ub0b4\ub3c4 stop key\uc5d0 \ud574\ub2f9\ud558\ub294 \uc815\ubcf4\ub294 \uc54c\uc544\uc11c \ucc28\ub2e8\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"\ube44\ubc00\ubc88\ud638-\ud574\uc26c\ud558\uae30",children:"\ube44\ubc00\ubc88\ud638 \ud574\uc26c\ud558\uae30"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add argon2\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ud65c\uc6a9\ud574\uc11c \ube44\ubc00\ubc88\ud638\ub97c hashing\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/ranisalt/node-argon2#readme",children:"https://github.com/ranisalt/node-argon2#readme"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\nimport { AuthDto } from './dto';\nimport * as argon from 'argon2';\n\n@Injectable({})\nexport class AuthService {\n  constructor(private prisma: PrismaService) {}\n  async signup(dto: AuthDto) {\n    const hash = await argon.hash(dto.password);\n    const salt = hash;\n    const user = await this.prisma.user.create({\n      data: { email: dto.email, hash, salt },\n    });\n    delete user.hash;\n    delete user.salt;\n    return user;\n  }\n\n  login() {\n    return { msg: 'good' };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ubaa8\ub974\ub358 \uc9c0\uc2dd\uc774\uc5c8\uc9c0\ub9cc argon\uc744 \ud65c\uc6a9\ud558\uba74 \uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638\ub97c \uc800\uc7a5\ud560 \ub54c salt\ub3c4 \uac19\uc774 \uc800\uc7a5\ud560 \ud544\uc694\ub294 \uc5c6\uc5c8\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"\ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30",children:"\ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:'generator client {\n  provider = "prisma-client-js"\n}\n\ndatasource db {\n  provider = "postgresql"\n  url      = env("DATABASE_URL")\n}\n\n\nmodel User{\n  id Int @id @default(autoincrement())\n  createAt DateTime @default(now())\n  updateAt DateTime @updatedAt\n  email String @unique\n  hash String\n  firstName String?\n  lastName String?\n\n  bookmarks Bookmark[]\n\n  @@map("users")\n}\n\nmodel Bookmark{\n  id Int @id @default(autoincrement())\n  createAt DateTime @default(now())\n  updateAt DateTime @updatedAt\n  title String\n  description String?\n  link String\n\n  userId Int\n  user User @relation(fields: [userId], references: [id])\n\n  @@map("bookmarks")\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ub418\uba74 \uc720\uc800\uac00 \ub4e4\uace0 \uc788\ub294 bookmark\ub97c \ud45c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. bookmarks\uc778 \uc774\uc720\ub294 \uc720\uc800\ub294 \uc5ec\ub7ec\uac1c\uc758 bookmark\ub97c \ub4e4\uc9c0\ub9cc bookmark\ub294 \ud558\ub098\uc758 \uc720\uc800\uc5d0\uac8c \uc950\uc5b4\uc9c0\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc720\uc800\ub77c\ub294 1\uacfc \ubd81\ub9c8\ud06c\ub77c\ub294 \uc5ec\ub7ec(\ub2e4) \ub300\uc751\uc774 \ub418\ub294 \uad6c\uc870\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774 \uae30\ud68c\uc5d0 \ud544\uc694\uc5c6\ub294 salt\ub3c4 \uc0ad\uc81c\ud569\uc2dc\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ub610 email\uc5d0 @unique\ub85c \uc9c0\uc815\ud574\uc11c \uc911\ubcf5 \uc0dd\uc131\ubb38\uc81c\ub3c4 \ucc28\ub2e8\ud574\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx prisma migrate dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc \uc911\ubcf5\uc0dd\uc131\uc744 \ud558\uba74 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uac8c 500\uc5d0\ub7ec\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. \uc774\uc0c1\ud55c \ud68c\uc0ac\uc640 \uc774\uc0c1\ud55c \ubc31\uc5d4\ub4dc\ub294 \ub9ce\uc9c0\ub9cc \uc6b0\ub9ac\ub294 \uc774\uac83\ubcf4\ub2e4 \ub354 \ubb38\uba85\uc778\ub2e4\uc6b4 \ubc29\ubc95\uc744 \ud65c\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { ForbiddenException, Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\nimport { AuthDto } from './dto';\nimport * as argon from 'argon2';\nimport { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\n\n@Injectable({})\nexport class AuthService {\n  constructor(private prisma: PrismaService) {}\n  async signup(dto: AuthDto) {\n    try {\n      const hash = await argon.hash(dto.password);\n      const user = await this.prisma.user.create({\n        data: { email: dto.email, hash },\n      });\n      delete user.hash;\n      return user;\n    } catch (error) {\n      if (error instanceof PrismaClientKnownRequestError) {\n        if (error.code === 'P2002') {\n          throw new ForbiddenException('email is taken');\n        }\n      }\n      throw error;\n    }\n  }\n\n  login() {\n    return { msg: 'good' };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc11c\ubc84\ub791 \ud1b5\uc2e0\ud558\ub294\ub370 \uc608\uc678\ucc98\ub9ac\ub97c \uc548 \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud2b9\uc774\ud558\uac8c Nest.js\ub294 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud558\uba74 \uc7a1\uace0 throw\ud569\ub2c8\ub2e4. \ucd94\uc0c1\ud654 \ud574\uc900\ub2e4\ub294 \uc810\uc774 \uc88b\uc740 \uac83 \uac19\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(n.p,{children:["\ucc38\uace0\ub85c ",(0,s.jsx)(n.code,{children:"P2002"}),"\uc740 Prisma \ubb38\uc11c \ub0b4\uc6a9\uc785\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.h3,{id:"\ub85c\uadf8\uc778-\ucc98\ub9ac\ud558\uae30",children:"\ub85c\uadf8\uc778 \ucc98\ub9ac\ud558\uae30"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { ForbiddenException, Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\nimport { AuthDto } from './dto';\nimport * as argon from 'argon2';\nimport { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\n\n@Injectable({})\nexport class AuthService {\n  constructor(private prisma: PrismaService) {}\n  async signup(dto: AuthDto) {\n    try {\n      const hash = await argon.hash(dto.password);\n      const user = await this.prisma.user.create({\n        data: { email: dto.email, hash },\n      });\n      delete user.hash;\n      return user;\n    } catch (error) {\n      if (error instanceof PrismaClientKnownRequestError) {\n        if (error.code === 'P2002') {\n          throw new ForbiddenException('email is taken');\n        }\n      }\n      throw error;\n    }\n  }\n\n  async login(dto: AuthDto) {\n    try {\n      const user = await this.prisma.user.findUnique({\n        where: { email: dto.email },\n      });\n\n      if (!user) throw new ForbiddenException('no email');\n      const pwMatch = await argon.verify(user.hash, dto.password);\n\n      if (!pwMatch) throw new ForbiddenException('password not match');\n\n      delete user.hash;\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uba87\ubc88\uc758 \uac80\uc99d\uac00\ub4dc\ub9cc \ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"db--\ud504\ub9ac\uc988\ub9c8-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uc790\ub3d9\ud654",children:"DB & \ud504\ub9ac\uc988\ub9c8 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc790\ub3d9\ud654"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://youtu.be/GHTA143_b-s?t=4645",children:"https://youtu.be/GHTA143_b-s?t=4645"})}),"\n",(0,s.jsx)(n.p,{children:"\ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc785\ub825\uc744 \uc704\ud574 \uc77c\uc77c\uc774 \uc785\ub825\ud558\ub294 \uac83\uc740 \ubc88\uac70\ub86d\uc2b5\ub2c8\ub2e4. \uc774\uac83\uc744 \uc790\ub3d9\ud654\ud558\ub294 script \uba85\ub839\uc744 \uc790\ub3d9\ud654\ud574\ubd05\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc7a0\uc2dc docker\ub97c \uc81c\uac70\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker compose rm --help\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  -f, --force     Don't ask to confirm removal\n  -s, --stop      Stop the containers, if required, before removing\n  -v, --volumes   Remove any anonymous volumes attached to containers\n"})}),"\n",(0,s.jsx)(n.p,{children:"docker\ub97c \uc81c\uc5b4\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8 \uba85\ub839\uc785\ub2c8\ub2e4. \ud604\uc7ac docker \uc124\uc815\uc744 \ub2e4\uc2dc\ud55c\ubc88\ub354 \ud655\uc778\ud558\uaca0\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"version: '3.8'\nservices:\n  dev-db:\n    image: postgres:13\n    ports:\n      - 5434:5432\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=123\n      - POSTGRES_DB=nest\n    networks:\n      - freecodecamp\nnetworks:\n  freecodecamp:\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "name": "nest-test",\n  "version": "0.0.1",\n  "scripts": {\n    "db:dev:rm": "docker compose rm dev-db -s -f -v",\n    "db:dev:up": "docker compose up dev-db -b",\n    "db:dev:restart": "yarn db:dev:rm && yarn db:dev:up"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn db:dev:restart\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc744 \ud558\uba74 docker\uc744 \uc7ac\uac00\ub3d9\ud558\ub294 \uba85\ub839\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"yarn run v1.22.19\n$ yarn db:dev:rm && yarn db:dev:up\n$ docker compose rm dev-db -s -f -v\n[+] Stopping 1/1\n \u2714 Container nest-test-dev-db-1  Stopped                                                   0.2s\nGoing to remove nest-test-dev-db-1\n[+] Removing 1/0\n \u2714 Container nest-test-dev-db-1  Removed                                                   0.0s\n$ docker compose up dev-db -d\n[+] Running 1/1\n \u2714 Container nest-test-dev-db-1  Started                                                   0.2s\n\u2728  Done in 1.05s.\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\uc774\ub7f0 \ud53c\ub4dc\ubc31\uc744 \ubc1b\uc740 \uac83\uc744 \ubcfc \uc218 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4. ",(0,s.jsx)(n.code,{children:"docker ps"}),"\uba85\ub839\uc73c\ub85c \uac00\ub3d9\uc744 \ud655\uc778\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c \ub9c8\uc774\uadf8\ub808\uc158\uc744 \uc801\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"prisma \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uba85\ub839\ub3c4 \uac19\uc774 \uc0ac\uc6a9\ud574\uc11c \uc790\ub3d9\ud654\ub97c \ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "name": "nest-test",\n  "version": "0.0.1",\n  "scripts": {\n    "prisma:dev:deploy": "prisma migrate deploy",\n    "db:dev:rm": "docker compose rm dev-db -s -f -v",\n    "db:dev:up": "docker compose up dev-db -b",\n    "db:dev:restart": "yarn db:dev:rm && yarn db:dev:up && sleep 1 && yarn prisma:dev:deploy"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn db:dev:restart\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uba85\ub839\ud558\uba74 \ub9c8\uc774\uadf8\ub808\uc774\uc158\uae4c\uc9c0 \ubaa8\ub450 \ucc98\ub9ac\ud574\uc904 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ucc38\uace0\ub85c \uc608\uc804\uc5d0 \uc911\uac04\uc5d0 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2e4\uc218\ub85c \ucd94\uac00\ud55c\uac70 \uc0ad\uc81c \ud558\ub2c8\uae4c \ubb34\uc2dc\ud558\uc9c0 \uc54a\uace0 \uc5d0\ub7ec\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc0ad\uc81c\ud560 \ub54c\ub294 \uc8fc\uc758\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uae4c\uc9c0 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc790\ub3d9\ud654\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"config-module",children:"config module"}),"\n",(0,s.jsx)(n.p,{children:"config module\ubd80\ud130 \uad6c\ud604\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="prisma.service.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { PrismaClient } from '@prisma/client';\nimport { env } from 'process';\n\n@Injectable()\nexport class PrismaService extends PrismaClient {\n  constructor() {\n    super({ datasources: { db: { url: env.DATABASE_URL } } });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704\uc5d0\uc11c \ucc98\ub9ac\ud55c \uac83\ubcf4\ub2e4 \uc870\uae08\ub354 \uc6b0\uc544\ud558\uac8c \ucc98\ub9ac\ud558\ub294 \ubc29\ubc95\uc744 \ubcfc \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add @nestjs/config\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud558\uba74 \ub05d\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"env \uc720\ud6a8\uc131 \uac80\uc99d\uc744 \uc704\ud574 config module\uc744 \ub530\ub85c \ud3f4\ub354\ub97c \ub9cc\ub4dc\ub294 \uacbd\uc6b0\uac00 \uc77c\ubc18\uc801\uc774\uc9c0\ub9cc \uac00\ubcbc\uc6b4 \ud504\ub85c\uc81d\ud2b8\uc5d0\ub294 root module\uc5d0 \ub9cc\ub4e4\uc5b4\ub3c4 \ubb38\uc81c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="app.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthModule } from './auth/auth.module';\nimport { UserModule } from './user/user.module';\nimport { BookmarkModule } from './bookmark/bookmark.module';\nimport { PrismaModule } from './prisma/prisma.module';\nimport { ConfigModule } from '@nestjs/config';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({}), // \uc5ec\uae30\n    AuthModule,\n    UserModule,\n    BookmarkModule,\n    PrismaModule,\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ube44\uc2b7\ud55c module\uc744 \ub2e4\uc2dc \uc791\uc131\ud558\uc9c0 \ub9d0\uace0 \ud504\ub808\uc784\uc6cc\ud06c\uac00 \uc774\ubbf8 \uc9c1\uc131\ud574\ub454 \uac83\uc744 \uadf8\ub0e5 \uc0ac\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"ConfigModule\uc740 \ub0b4\ubd80\uc801\uc73c\ub85c dotenv\ub97c \ub0b4\ubd80\uc801\uc73c\ub85c \ud65c\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="app.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthModule } from './auth/auth.module';\nimport { UserModule } from './user/user.module';\nimport { BookmarkModule } from './bookmark/bookmark.module';\nimport { PrismaModule } from './prisma/prisma.module';\nimport { ConfigModule } from '@nestjs/config';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({ isGlobal: true }),\n    AuthModule,\n    UserModule,\n    BookmarkModule,\n    PrismaModule,\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"isGlobal \ud50c\ub808\uadf8\ub85c global \ub370\ucf54\ub808\uc774\ud130\ub85c \uc811\uadfc\ud560 \uc218 \uc788\uac8c \ud574\uc900 \uac83\ucc98\ub7fc \uc124\uc815\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient {\n  constructor(config: ConfigService) {\n    super({ datasources: { db: { url: config.get('DATABASE_URL') } } });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc124\uc815\ud558\uba74 \ud0c0\uc785\uc138\uc774\ud504\ud558\uac8c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Injectable\ub85c \uc758\uc874\uc131 \uc8fc\uc785\uc744 \ubc1b\uc744 \uc218 \uc788\uac8c \ud558\uace0 config \ud074\ub798\uc2a4 \uba54\uc11c\ub4dc\uc5d0\uc11c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"jwt-\uc778\uc99d-\uc778\uac00",children:"JWT \uc778\uc99d, \uc778\uac00"}),"\n",(0,s.jsx)(n.p,{children:"\uc0ac\uc6a9\uc790\uac00 \ubcf8\uc778 \uc778\uc99d\uc744 \uc704\ud574 \ub85c\uadf8\uc778\ud558\uba74 \uc778\uc99d\uc785\ub2c8\ub2e4. \uc778\uc99d \uc774\ud6c4 \uacc4\uc18d \ubcf4\uc548\uc0c1 \ubcf4\ud638\ubc1b\uc73c\uba74 \uc778\uac00\uac00\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \uc608\uc2dc\uc5d0\uc11c\ub294 JWT\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"JWT\ub97c \ucc98\ub9ac\ud558\uae30 \uc704\ud574\uc11c \ub530\ub85c \ubaa8\ub4c8\uc744 \uc815\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\uc804 \uc608\uc2dc\ub294 \uc9c1\uc811 \ucee4\uc2a4\ud140\uc73c\ub85c \ubaa8\ub4c8\uc744 \ub9cc\ub4e0 \uc608\uc2dc\uc785\ub2c8\ub2e4. \uc774\uc81c\ub294 Nest.js\uac00 \uc81c\uacf5\ud558\ub294 module\uc744 \ud65c\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc778\uc99d, \uc778\uac00\ub294 \uc0c1\ub2f9\ud788 \uac04\ub2e8\ud560 \uac83\uc774\ub77c\ub294 \ucc29\uac01\ud558\uae30 \uc27d\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc2e4\uc81c\ub85c\ub294 \uaf64 \uc5b4\ub835\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"nest\ub294 \uc774\ubbf8 \ub0b4\ubd80\uc801\uc73c\ub85c \uad6c\ud604\ud55c \uac83\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \ub0b4\ubd80\uc801\uc73c\ub85c\ub294 past port\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.passportjs.org/",children:"https://www.passportjs.org/"})}),"\n",(0,s.jsx)(n.p,{children:"express\ub97c \uc704\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc5ec\uae30\uc11c JWT\ub97c \ud65c\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add @nestjs/passport passport\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc73c\ub85c passport\ub97c \uc124\uce58\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add @nestjs/jwt passport-jwt\nyarn add -D @types/passport-jwt\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.module.ts"',children:"import { Module } from '@nestjs/common';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\nimport { JwtModule } from '@nestjs/jwt';\n\n@Module({\n  imports: [JwtModule.register({})],\n  controllers: [AuthController],\n  providers: [AuthService],\n})\nexport class AuthModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ubaa8\ub4c8\uc744 \uc5f0\uacb0\ud574\uc8fc\uba74\ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="auth.service.ts"',children:"import { ForbiddenException, Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\nimport { AuthDto } from './dto';\nimport * as argon from 'argon2';\nimport { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\nimport { JwtService } from '@nestjs/jwt';\n\n@Injectable({})\nexport class AuthService {\n  constructor(private prisma: PrismaService, private jwt: JwtService) {}\n  async signup(dto: AuthDto) {}\n\n  async login(dto: AuthDto) {}\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc5f0\uacb0\ud574\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { ForbiddenException, Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/prisma/prisma.service';\nimport { AuthDto } from './dto';\nimport * as argon from 'argon2';\nimport { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\nimport { JwtService } from '@nestjs/jwt';\nimport { ConfigService } from '@nestjs/config';\n\n@Injectable({})\nexport class AuthService {\n  constructor(\n    private prisma: PrismaService,\n    private jwt: JwtService,\n    private config: ConfigService\n  ) {}\n  async signup(dto: AuthDto) {}\n\n  async login(dto: AuthDto) {\n    try {\n      const user = await this.prisma.user.findUnique({\n        where: { email: dto.email },\n      });\n      if (!user) throw new ForbiddenException('no email');\n      const pwMatch = await argon.verify(user.hash, dto.password);\n      if (!pwMatch) throw new ForbiddenException('password not match');\n      return await this.signToken(user.id, user.email);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  async signToken(userId: number, email: string) {\n    const payload = { sub: userId, email };\n\n    const secret = this.config.get('JWT_SECRET');\n\n    const token = await this.jwt.signAsync(payload, {\n      expiresIn: '60m',\n      secret,\n    });\n\n    return {\n      access_token: token,\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud574\uc8fc\uba74 \uc804\ud1b5\uc801\uc778 access_token\uc744 \ubc18\ud658\ud558\ub294 \uba54\uc11c\ub4dc\ub97c \ub9cc\ub4e4\uace0 \ub85c\uadf8\uc778 \uac31\uc2e0\uc5d0 \uc751\ub2f5\ud560 \uc218 \uc788\ub294 \uba54\uc11c\ub4dc\ub97c \ub9cc\ub4e4 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c\ubd80\ud130 \uc778\uac00 \uc720\ud6a8\uc131 \uac80\uc99d\uc785\ub2c8\ub2e4. \uc774\ub7f0\uac83\uc744 \uc77c\ubc18\uc801\uc73c\ub85c \uc804\ub7b5\uc774\ub77c\uace0 \ubd80\ub985\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/recipes/passport#implementing-passport-jwt",children:"https://docs.nestjs.com/recipes/passport#implementing-passport-jwt"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub7f0 \ud615\ud0dc\ub85c \uc791\uc131\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Module } from '@nestjs/common';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\nimport { JwtModule } from '@nestjs/jwt';\nimport { JwtStrategy } from './strategy';\n\n@Module({\n  imports: [JwtModule.register({})],\n  controllers: [AuthController],\n  providers: [AuthService, JwtStrategy],\n})\nexport class AuthModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc5f0\uacb0\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="strategy/jwt.strategy.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor(private config: ConfigService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: config.get('JWT_SECRET'),\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uad6c\ud604\ud558\uace0 \ubca0\ub7f0 export\ub85c \ub0b4\ubcf4\ub0b4\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c \uac04\ub2e8\ud55c \uad6c\ud604 \ud655\uc778\uc744 \ud574\uaca0\uc2b5\ub2c8\ub2e4. \ubcf8\uc778 \uc778\uac00\uac00 \ud544\uc694\ud55c \ub9ac\uc18c\uc2a4\uc778\uc9c0 \uac80\uc99d\ud558\ub294 \ub85c\uc9c1\uc744 \uad6c\ud604\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"guards",children:"guards"}),"\n",(0,s.jsx)(n.p,{children:"\uc989 \uac04\ub2e8\ud55c \uc218\uc900\uc758 \uac00\ub4dc\ub97c \ub9cc\ub4e4\uace0 get \uc694\uccad\uc744 \uad6c\ud604\ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/guards",children:"https://docs.nestjs.com/guards"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest g controller user --no-spec\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get } from '@nestjs/common';\n\n@Controller('users')\nexport class UserController {\n  @Get('me')\n  getMe() {\n    return 'user info';\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"http://localhost:3000/users/me",children:"http://localhost:3000/users/me"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\ub85c get \uc694\uccad\uc73c\ub85c \uad6c\ud604\uc744 \ud655\uc778\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="jwt.strategy.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy, 'jwt') {\n  constructor(private config: ConfigService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: config.get('JWT_SECRET'),\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"JWT \uc124\uc815\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="user.controller.ts"',children:"import { Controller, Get, UseGuards } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\n\n@Controller('users')\nexport class UserController {\n  @UseGuards(AuthGuard('jwt'))\n  @Get('me')\n  getMe() {\n    return 'user info';\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uac00\ub4dc \uc124\uc815\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ub3d9\uc77c\ud55c \ubb38\uc790\uc5f4\uc744 \uc785\ub825\ud558\ub294 \uac83\uc73c\ub85c \ub3d9\uc77c\ud55c \uc804\ub7b5\uc758 \ubcf4\ud638\ub97c \ubc1b\ub294 \uac83\uc774\ub77c\uace0 \uc124\uc815\ud558\ub294 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy, 'jwt') {\n  constructor(private config: ConfigService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: config.get('JWT_SECRET'),\n    });\n  }\n\n  validate(payload: any) {\n    console.log({ payload });\n    return payload;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc720\ud6a8\uc131\uac80\uc99d\ud558\uba74 \ud1b5\uacfc\ub429\ub2c8\ub2e4. \uc694\uccad \uac1d\uccb4\uc5d0\uc11c \ucd94\uac00\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get, Req, UseGuards } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { Request } from 'express';\n\n@Controller('users')\nexport class UserController {\n  @UseGuards(AuthGuard('jwt'))\n  @Get('me')\n  getMe(@Req() req: Request) {\n    console.log(req.user);\n    return 'user info';\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc694\uccad \uac1d\uccb4\uc5d0 \ucd94\uac00\ud55c\ub2e4\ub294 \uc758\ubbf8\ub294 \uc5ec\uae30\uc11c \uc774\ud574\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. payload\uc5d0 \uc720\uc800\uac00 \uc811\uadfc\uac00\ub2a5\ud574\uc9d1\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc18c\ube44\ud560 \ub54c \uc720\uc800 JWT \uc815\ubcf4\ub97c \uc811\uadfc\ud558\uace0 \ud65c\uc6a9\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport { PrismaService } from 'src/prisma/prisma.service';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy, 'jwt') {\n  constructor(config: ConfigService, private prisma: PrismaService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: config.get('JWT_SECRET'),\n    });\n  }\n\n  async validate(payload: { sub: number; email: string }) {\n    const user = await this.prisma.user.findUnique({\n      where: {\n        id: payload.sub,\n      },\n    });\n    delete user.hash;\n    return user;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud574\uc11c \ubcf8\uc778\uc778\uc99d\uc744 \ud569\ub2c8\ub2e4. DB\uc5d0 \uc720\uc800\uac00 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uace0 \uc5c6\uc73c\uba74 \uc811\uadfc \uae08\uc9c0 \uc788\uc73c\uba74 \ud5c8\uc6a9\ud558\uace0 \uc720\uc800\uc815\ubcf4\ub97c \uc694\uccad\uac1d\uccb4\uc5d0 \ubd99\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get, Req, UseGuards } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { Request } from 'express';\n\n@Controller('users')\nexport class UserController {\n  @UseGuards(AuthGuard('jwt'))\n  @Get('me')\n  getMe(@Req() req: Request) {\n    return req.user;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ubcf8\uc778\uc815\ubcf4\ub97c \ubcfc \uc218 \uc788\uac8c \uc81c\uacf5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \ub354 \uac1c\uc120\ud558\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ucee4\uc2a4\ud140 \uac00\ub4dc \uc124\uc815\uc73c\ub85c \uc774\uc81c \ucd94\ucd9c\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="guard/jwt.guard.ts"',children:"import { AuthGuard } from '@nestjs/passport';\n\nexport class JwtGuard extends AuthGuard('jwt') {\n  constructor() {\n    super();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc124\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get, Req, UseGuards } from '@nestjs/common';\nimport { Request } from 'express';\nimport { JwtGuard } from 'src/auth/guard';\n\n@Controller('users')\nexport class UserController {\n  @UseGuards(JwtGuard)\n  @Get('me')\n  getMe(@Req() req: Request) {\n    return req.user;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc124\uc815\ud558\uba74 \ub9e4\uc9c1 \uc2a4\ud2b8\ub9c1\uc744 \uc81c\uac70\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"custom-param-decorator",children:"custom param decorator"}),"\n",(0,s.jsx)(n.p,{children:"\ucee4\uc2a4\ud140\uc73c\ub85c \ub370\ucf54\ub808\uc774\ud130\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/custom-decorators",children:"https://docs.nestjs.com/custom-decorators"})}),"\n",(0,s.jsx)(n.p,{children:"\uacf5\uc2dd\ubb38\uc11c\ub97c \ucc38\uace0\ud574\uc11c \uaf64 \ub2e4\uc591\ud55c \uac83\uc744 \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="decorator/get-user.decorator.ts"',children:"import { createParamDecorator, ExecutionContext } from '@nestjs/common';\n\nexport const GetUser = createParamDecorator(\n  (data: unknown, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.user;\n  }\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc77c\ub2e8 \uacf5\uc2dd\ubb38\uc11c\uc5d0\uc11c \uc800 \ub0b4\uc6a9\uc744 \ubcf5\uc0ac\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get, UseGuards } from '@nestjs/common';\nimport { User } from '@prisma/client';\nimport { GetUser } from 'src/auth/decorator';\nimport { JwtGuard } from 'src/auth/guard';\n\n@UseGuards(JwtGuard)\n@Controller('users')\nexport class UserController {\n  @Get('me')\n  getMe(@GetUser('') user: User) {\n    return user;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uc774\uc804\uc5d0 express\uc5d0 \uc788\ub358 \ub370\ucf54\ub808\uc774\ud130\ub97c \ucd94\uc0c1\ud654\ud558\uac8c \ub429\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uac00\ub4dc\ub3c4 users \uc5d4\ub4dc \ud3ec\uc778\ud2b8 \uc804\uccb4 \uc801\uc6a9\ud558\uac8c \ucee8\ud2b8\ub864\ub85c \uc704\ub85c \uc62e\uacbc\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"express\uac00 \ub0b4\ubd80\uc758 \uc720\uc800 \uc815\ubcf4\ub97c \uc811\uadfc\ud558\ub294 \ub85c\uc9c1\uc744 \uc228\uae30\uace0 \ucd94\uc0c1\ud654\ud55c \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \uc720\uc800\uc758 \ud2b9\uc815 \uc815\ubcf4\ub9cc \uc811\uadfc\ud558\uac8c \ub9cc\ub4dc\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { createParamDecorator, ExecutionContext } from '@nestjs/common';\n\nexport const GetUser = createParamDecorator(\n  (data: string | undefined, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    if (data) return request.user[data];\n    return request.user;\n  }\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ub370\ucf54\ub808\uc774\ud130\ub97c \uc774\ub807\uac8c \uc124\uc815\ud558\uba74 \ud574\ub2f9\ud558\ub294 \ud544\ub4dc\ub97c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Controller, Get, UseGuards } from '@nestjs/common';\nimport { User } from '@prisma/client';\nimport { GetUser } from 'src/auth/decorator';\nimport { JwtGuard } from 'src/auth/guard';\n\n@UseGuards(JwtGuard)\n@Controller('users')\nexport class UserController {\n  @Get('me')\n  getMe(@GetUser('email') user: string) {\n    console.log(user);\n    return user;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud638\ucd9c\ud558\uba74 email\ub9cc \uc774\ub807\uac8c \uc811\uadfc\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Body, Controller, HttpCode, HttpStatus, Post } from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { AuthDto } from './dto';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private authService: AuthService) {}\n\n  @Post('signup')\n  signup(@Body() dto: AuthDto) {\n    return this.authService.signup(dto);\n  }\n\n  @HttpCode(HttpStatus.OK) // 200 \uc751\ub2f5\uc744 \ud569\ub2c8\ub2e4.\n  @Post('signin')\n  signin(@Body() dto: AuthDto) {\n    return this.authService.login(dto);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc6d0\ub798 post\ub294 \uae30\ubcf8\uc801\uc73c\ub85c 201\uc751\ub2f5\uc744 \ud558\ub294\ub370 \uc774\ub807\uac8c \uc0ac\uc6a9\ud558\uba74 200\uc751\ub2f5\uc73c\ub85c \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub85c\uadf8\uc778\uc740 post\uc774\uc9c0\ub9cc \uba71\ub4f1\uc131\uc744 \ubcf4\uc7a5\ud558\uae30 \ub54c\ubb38\uc5d0 200\uc751\ub2f5\uc744 \uc900\ub2e4\ub294 \ub85c\uc9c1\uc744 \uad6c\ud604\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc0c1\ud0dc \ucf54\ub4dc\ub97c \uc751\ub2f5\ud558\ub294 \uac83\ub3c4 enum\uc73c\ub85c \uc81c\uacf5\ud574\uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"e2e-tests-with-pactumjs",children:"e2e tests with pactumJs"}),"\n",(0,s.jsx)(n.p,{children:"\ub9ce\uc740 \uacbd\uc6b0 \uc218\ub3d9 \ud14c\uc2a4\ud2b8\ub97c \ud558\ub294\ub370 \uc810\uc810\ub354 \ub85c\uc9c1\uc774 \ub9ce\uc544\uc9c0\uba74\uc11c \uc218\ub3d9 \ud14c\uc2a4\ud2b8\uac00 \ubc88\uac70\ub85c\uc6cc\uc9d1\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\ub97c \uc790\ub3d9\uc73c\ub85c \ucc98\ub9ac\ud574\uc8fc\ub294 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc791\uc131\ud558\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ub2e8\uc704 \ud14c\uc2a4\ud2b8, \uacb0\ud569 \ud14c\uc2a4\ud2b8, E2E \ud14c\uc2a4\ud2b8"}),"\n",(0,s.jsx)(n.p,{children:"\ud14c\uc2a4\ud2b8 DB\ub3c4 \ub530\ub85c \ub9cc\ub4e4\uc5b4\uc11c \uacb0\ud569\ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud569\ub2c8\ub2e4. E2E \ud14c\uc2a4\ud2b8\ub294 \uc720\uc800 \uc2a4\ud1a0\ub9ac, \uc720\uc800 \uc800\ub2c8\ub97c \ud65c\uc6a9\ud574\uc11c \ub300\ud45c\uc801\uc778 \uc720\uc2a4\ucf00\uc774\uc2a4 \ud574\ud53c\ud398\uc2a4\ub97c \uac80\uc99d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uac1c\ubc1c\uc5d0 2\uc8fc\ub97c \uac78\ub9ac\uba74 \ud14c\uc2a4\ud2b8\ub3c4 2\uc8fc\uc815\ub3c4 \uc9c4\ud589\ud560 \uac00\ub2a5\uc131\ub3c4 \ub192\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"E2E \ud14c\uc2a4\ud2b8\ub294 super test \uae30\ubcf8 \uc124\uce58\ub418\uc5b4 \uc788\uc9c0\ub9cc pactum\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://pactumjs.github.io/",children:"https://pactumjs.github.io/"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add -D pactum\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uccab\uc9f8\ub85c \ud560 \uac83\uc740 \ud14c\uc2a4\ud2b8\ud658\uacbd \uc804\uc6a9 DB\ub97c \ub9cc\ub4dc\ub294 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \ud14c\uc2a4\ud2b8\uac00 \uc885\ub8cc\ub418\uba74 DB\ub97c \uccad\uc18c\ud574\uc57c \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="test/app.e2e-spec.ts"',children:"describe('App (e2e)', () => {\n  it.todo('should pass');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn test:e2e\n"})}),"\n",(0,s.jsx)(n.p,{children:"e2e \uad00\ub828 \ud14c\uc2a4\ud2b8 \uba85\ub839\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"yarn run v1.22.19\n$ jest --config ./test/jest-e2e.json\n PASS  test/app.e2e-spec.ts\n  App (e2e)\n    \u270e todo should pass\n\nTest Suites: 1 passed, 1 total\nTests:       1 todo, 1 total\nSnapshots:   0 total\nTime:        0.982 s\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704\uc640 \uac19\uc740 \ud53c\ub4dc\ubc31\uc744 \uc90d\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from 'src/app.module';\n\ndescribe('App (e2e)', () => {\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n  });\n\n  it.todo('should pass');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"AppModule\uc744 \ubd88\ub7ec\uc635\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"E2E\ub294 \ubaa8\ub4e0 \uacb0\ud569\uc9c0\uc810\uc744 \ud14c\uc2a4\ud2b8\ud558\uace0 \uc720\uc800\uac00 \uc2e4\uc81c\ub85c \ud560 \uac83\uac19\uc740 \ud589\ub3d9\uc758 \ud750\ub984 \uc804\uccb4\ub97c \uac80\uc99d\ud558\uae30 \ub54c\ubb38\uc5d0 \uc804\uccb4\ub97c \uac00\uc838\uc635\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "test": "jest",\n    "test:watch": "jest --watch",\n    "test:cov": "jest --coverage",\n    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",\n    // \uc544\ub798 --watch --no-cache \ud50c\ub798\uadf8\ub97c \ucd94\uac00\ud574\uc8fc\uc138\uc694\n    "test:e2e": "jest --watch --no-cache --config ./test/jest-e2e.json"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\n\ndescribe('App (e2e)', () => {\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    const app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n  });\n\n  it.todo('should pass');\n  it.todo('should pass 2');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uac80\uc99d\ud30c\uc774\ud504 \uae4c\uc9c0 \ucd94\uac00\ud558\uace0 moduleRef\ub85c \uc2e4\uc81c \uc571\uc5d0 \ucd5c\ub300\ud55c \ube44\uc2b7\ud558\uac8c \ub9cc\ub4e4\ub3c4\ub85d \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"DTO \ud30c\uc774\ud504\ub294 main.ts\uc5d0\uc11c \uc124\uc815\ud588\ub358 \uae30\ub2a5\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  it.todo('should pass');\n  it.todo('should pass 2');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc571\uc744 \ud14c\uc2a4\ud2b8\ud558\ub294 \ub3d9\uc548 \uc0dd\uc131\ud558\uace0 \ud14c\uc2a4\ud2b8\uac00 \uc885\ub8cc\ub418\uba74 \uc571\uc744 \ub2eb\ub3c4\ub85d \ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c\ubd80\ud130 \ub370\uc774\ud130 \ubca0\uc774\uc2a4\ub97c \ub9cc\ub4ed\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \uc804\uc6a9 DB\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"version: '3.8'\nservices:\n  dev-db:\n    image: postgres:13\n    ports:\n      - 5434:5432\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=123\n      - POSTGRES_DB=nest\n    networks:\n      - freecodecamp\n  test-db: # \uc774\ub984\n    image: postgres:13\n    ports:\n      - 5435:5432 # \ud3ec\ud2b8\ubc88\ud638 \ubcc0\uacbd\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=123\n      - POSTGRES_DB=nest\n    networks:\n      - freecodecamp\nnetworks:\n  freecodecamp:\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub984\uc774\ub791 \ud3ec\ud2b8\ub9cc \ubc14\uafb8\uace0 \ubcf5\uc0ac\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "prisma:dev:deploy": "prisma migrate deploy",\n    "db:dev:rm": "docker compose rm dev-db -s -f -v",\n    "db:dev:up": "docker compose up dev-db -d",\n    "db:dev:restart": "yarn db:dev:rm && yarn db:dev:up && sleep 1 && yarn prisma:dev:deploy",\n\n    //\n    "prisma:test:deploy": "prisma migrate deploy",\n    "db:test:rm": "docker compose rm test-db -s -f -v",\n    "db:test:up": "docker compose up test-db -d",\n    "db:test:restart": "yarn db:test:rm && yarn db:test:up && sleep 1 && yarn prisma:test:deploy"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ubcf5\uc0ac\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ub2e4\uc74c\uc5d0\ub294 dotenv-cli\ub97c \uc124\uce58\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"yarn add -D dotenv-cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc124\uce58\ud558\uba74 \ud14c\uc2a4\ud2b8\ud658\uacbd\uc5d0 .env\ub97c \uc8fc\uc785\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "prisma:dev:deploy": "prisma migrate deploy",\n    "db:dev:rm": "docker compose rm dev-db -s -f -v",\n    "db:dev:up": "docker compose up dev-db -d",\n    "db:dev:restart": "yarn db:dev:rm && yarn db:dev:up && sleep 1 && yarn prisma:dev:deploy",\n\n    //\n    "prisma:test:deploy": "dotenv -e .env.test -- prisma migrate deploy",\n    "db:test:rm": "docker compose rm test-db -s -f -v",\n    "db:test:up": "docker compose up test-db -d",\n    "db:test:restart": "yarn db:test:rm && yarn db:test:up && sleep 1 && yarn prisma:test:deploy",\n\n    //\n    "test:e2e": "dotenv -e .env.test -- jest --watch --no-cache --config ./test/jest-e2e.json"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c dotenv \uc124\uc815\uc744 \ud558\uace0 .env.test\ud30c\uc77c\uc5d0\ub294 \ub2e4\uc74c\ucc98\ub7fc \uc791\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'DATABASE_URL="postgresql://postgres:123@localhost:5435/nest?schema=public"\nJWT_SECRET=(\ube44\ubc00)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\ud3ec\ud2b8\ubc88\ud638\ub97c \uc870\uc2ec\ud558\uae30 \ubc14\ub78d\ub2c8\ub2e4. 5435\ub85c \uc791\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"package.json\uc5d0 \ub180\ub78d\uac8c\ub3c4 hook\uc744 \uc124\uc815\ud558\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "prisma:dev:deploy": "prisma migrate deploy",\n    "db:dev:rm": "docker compose rm dev-db -s -f -v",\n    "db:dev:up": "docker compose up dev-db -d",\n    "db:dev:restart": "yarn db:dev:rm && yarn db:dev:up && sleep 1 && yarn prisma:dev:deploy",\n\n    //\n    "prisma:test:deploy": "dotenv -e .env.test -- prisma migrate deploy",\n    "db:test:rm": "docker compose rm test-db -s -f -v",\n    "db:test:up": "docker compose up test-db -d",\n    "db:test:restart": "yarn db:test:rm && yarn db:test:up && sleep 1 && yarn prisma:test:deploy",\n\n    //\n    "pretest:e2e": "yarn db:test:restart",\n    "test:e2e": "dotenv -e .env.test -- jest --watch --no-cache --config ./test/jest-e2e.json"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"pre \uc811\ub450\uc5b4\ud558\uace0 \uc2e4\ud589\ud560 \uba85\ub839\uc744 \ubd99\uc774\uba74 \uc2e4\ud589 \uc804\uc5d0 \uba3c\uc800 \uc2e4\ud589\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"docker ps\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc704 \uba85\ub839\uc744 \ud655\uc778\ud558\uba74 docker\uac00 2\uac1c \uc2e4\ud589\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx dotenv -e .env.test -- prisma studio\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uba85\ub839\uc740 \ud14c\uc2a4\ud2b8 \ud658\uacbd DB\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx dotenv -e .env -- prisma studio\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud558\uba74 \uac1c\ubc1c\ud658\uacbd DB\uc5d0 \uc5f0\uacb0\ud574\uc11c \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"prisma-database-teardown-logic",children:"Prisma database teardown logic"}),"\n",(0,s.jsx)(n.p,{children:"\ud14c\uc2a4\ud2b8\ub97c \uc2e4\ud589\ud560 \ub54c\ub9c8\ub2e4 DB\ub97c \ucd08\uae30\ud654\ud574\uc8fc\ub294 \uc791\uc5c5\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uba54\uc11c\ub4dc\ub97c \uc11c\ube44\uc2a4\uc5d0 \ucd94\uac00\ud574\uc11c DB\ub97c \ube44\uc6b0\ub294 \uc791\uc5c5\uc744 \ud560 \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="prisma.service.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient {\n  constructor(config: ConfigService) {\n    super({ datasources: { db: { url: config.get('DATABASE_URL') } } });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \ub85c\uc9c1\uc744 \uad6c\ud604\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ucc38\uace0\ub85c \ud2b8\ub80c\uc988\uc561\uc158\uc774\ub77c\ub294 \uac83\uc740 DB\ub97c \ub300\uc0c1\uc73c\ub85c \ud2b9\uc815 \uba85\ub839\uc744 \uc21c\uc11c\ub300\ub85c \uc2e4\ud589\ud558\ub294 \uac83\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="prisma.service.ts"',children:"import { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient {\n  constructor(config: ConfigService) {\n    super({ datasources: { db: { url: config.get('DATABASE_URL') } } });\n  }\n\n  cleanDB() {\n    this.$transaction([this.bookmark.deleteMany(), this.user.deleteMany()]);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud14c\uc5b4\ub2e4\uc6b4 \ub85c\uc9c1 \uc774\uac83\uc774 \ub300\ubd80\ubd84\uc785\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud574\ubcfc \uac83\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\nimport { PrismaService } from '../src/prisma/prisma.service';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  let prisma: PrismaService;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n\n    prisma = app.get(PrismaService);\n    prisma.cleanDB();\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  it.todo('should pass');\n  it.todo('should pass 2');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc5f0\uacb0\ud574\uc8fc\uba74 \ub05d\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\nimport { PrismaService } from '../src/prisma/prisma.service';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  let prisma: PrismaService;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n\n    prisma = app.get(PrismaService);\n    prisma.cleanDB();\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  describe('auth', () => {});\n  describe('user', () => {});\n  describe('Bookmarks', () => {});\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"3\uac00\uc9c0 \ud14c\uc2a4\ud2b8\ub97c \uba3c\uc800 \uc791\uc131\ud558\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\nimport { PrismaService } from '../src/prisma/prisma.service';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  let prisma: PrismaService;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n\n    prisma = app.get(PrismaService);\n    prisma.cleanDB();\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  describe('auth', () => {\n    describe('sign up', () => {});\n    describe('sign in', () => {});\n  });\n  describe('user', () => {\n    describe('get me', () => {});\n    describe('Edit user', () => {});\n  });\n  describe('Bookmarks', () => {\n    describe('create bookmarks', () => {});\n    describe('get bookmarks', () => {});\n    describe('get bookmarks by id', () => {});\n    describe('edit bookmarks by id', () => {});\n    describe('delete bookmarks by id', () => {});\n  });\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc774\ub808\ubca8 \ud14c\uc2a4\ud2b8\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\nimport { PrismaService } from '../src/prisma/prisma.service';\nimport * as pactum from 'pactum';\nimport { AuthDto } from 'src/auth/dto';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  let prisma: PrismaService;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n    await app.listen(3333);\n\n    prisma = app.get(PrismaService);\n    prisma.cleanDB();\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  describe('auth', () => {\n    describe('sign up', () => {\n      it('should sign up', () => {\n        const dto: AuthDto = {\n          email: 'username@email.com',\n          password: '1234',\n        };\n        return pactum\n          .spec()\n          .post('http://localhost:3333/auth/signup')\n          .withBody(dto)\n          .expectStatus(201);\n      });\n    });\n    describe('sign in', () => {\n      it.todo('should');\n    });\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c \uc694\uccad\uc744 \ubcf4\ub0bc\ub54c base url\uc744 \uc77c\uc77c\uc774 \uc785\ub825\ud558\uae30\uc5d0\ub294 \ubc88\uac70\ub86d\uc2b5\ub2c8\ub2e4. \uc704\uc5d0 beforeAll\uc5d0 \uc815\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Test } from '@nestjs/testing';\nimport { AppModule } from '../src/app.module';\nimport { ValidationPipe } from '@nestjs/common';\nimport { NestApplication } from '@nestjs/core';\nimport { PrismaService } from '../src/prisma/prisma.service';\nimport * as pactum from 'pactum';\nimport { AuthDto } from 'src/auth/dto';\n\ndescribe('App (e2e)', () => {\n  let app: NestApplication;\n  let prisma: PrismaService;\n  beforeAll(async () => {\n    const moduleRef = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n\n    // DTO \uac80\uc99d\uc744 \uc704\ud55c \ud30c\uc774\ud504\n    app.useGlobalPipes(new ValidationPipe({ whitelist: true }));\n    await app.init();\n    await app.listen(3333);\n\n    prisma = app.get(PrismaService);\n    prisma.cleanDB();\n    pactum.request.setBaseUrl('http://localhost:3333'); // \uc5ec\uae30 \ub123\uc2b5\ub2c8\ub2e4.\n  });\n\n  afterAll(() => {\n    app.close();\n  });\n\n  describe('auth', () => {\n    describe('sign up', () => {\n      it('should sign up', () => {\n        const dto: AuthDto = {\n          email: 'username@email.com',\n          password: '1234',\n        };\n        return pactum\n          .spec()\n          .post('/auth/signup')\n          .withBody(dto)\n          .expectStatus(201);\n      });\n    });\n    describe('sign in', () => {\n      it.todo('should');\n    });\n  });\n  describe('user', () => {\n    describe('get me', () => {});\n    describe('Edit user', () => {});\n  });\n  describe('Bookmarks', () => {\n    describe('create bookmarks', () => {});\n    describe('get bookmarks', () => {});\n    describe('get bookmarks by id', () => {});\n    describe('edit bookmarks by id', () => {});\n    describe('delete bookmarks by id', () => {});\n  });\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"pactum\uc740 token \uc800\uc7a5\uc744 \ud749\ub0b4\ub0bc \uc218 \uc788\uac8c \uc2e4\ud589 \ucee8\ud14d\uc2a4\ud2b8\uc5d0 \ubcc0\uc218 \uc800\uc7a5 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"it('should sign in', () => {\n  return pactum\n    .spec()\n    .post('/auth/signin')\n    .withBody(dto)\n    .expectStatus(200)\n    .stores('userAt', 'access_token');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uc11c stores\uc5d0 \uc800\uc7a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"it('should get current me', () => {\n  return pactum\n    .spec()\n    .get('/users/me')\n    .withHeaders({ Authorization: `Bearer $S{userAt}` })\n    .expectStatus(200);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"\ub098\uc911\uc5d0\ub294 \uc774\ub807\uac8c \uc811\uadfc\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub7f0 \ud14c\uc2a4\ud2b8\uac00 E2E \ud14c\uc2a4\ud2b8 \ub300\ubd80\ubd84\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\uc774\uc81c\ubd80\ud130 \ud14c\uc2a4\ud2b8\ub97c \uba3c\uc800 \uc791\uc131\ud558\uace0 \uae30\ub2a5\uc744 \uad6c\ud604\ud558\ub294 \uc791\uc5c5\uc73c\ub85c \uc21c\uc73c\ub85c \uc9c4\ud589\ud558\uaca0\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"nest g service user --no-spec\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc11c\ube44\ub97c \ub530\ub85c \ub9cc\ub4ed\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"describe('Edit user', () => {\n  it('should edit current me', () => {\n    const dto: EditUserDto = {\n      email: 'newuseremail@email.net',\n      firstName: 'user',\n    };\n    return pactum\n      .spec()\n      .patch('/users')\n      .withHeaders({ Authorization: `Bearer $S{userAt}` })\n      .withBody(dto)\n      .expectStatus(200)\n      .expectBodyContains(dto.email);\n  });\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"expectBodyContains\uc73c\ub85c \uc751\ub2f5 body\ub97c \uac80\uc99d\ud574\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  Param,\n  ParseIntPipe,\n  Patch,\n  Post,\n  UseGuards,\n} from '@nestjs/common';\nimport { JwtGuard } from 'src/auth/guard';\nimport { BookmarkService } from './bookmark.service';\nimport { GetUser } from 'src/auth/decorator';\nimport { CreateBookmarkDto, EditBookmarkDto } from './dto';\n\n@UseGuards(JwtGuard)\n@Controller('bookmark')\nexport class BookmarkController {\n  constructor(private bookmarkService: BookmarkService) {}\n  @Get()\n  getBookmarks(@GetUser('id') userId: number) {\n    //\n  }\n\n  @Get(':id')\n  getBookmarkById(\n    @GetUser('id') userId: number,\n    @Param('id', ParseIntPipe) bookmarkId: number\n  ) {\n    //\n  }\n\n  @Post()\n  createBookmark(\n    @GetUser('id') userId: number,\n    @Body() dto: CreateBookmarkDto\n  ) {\n    //\n  }\n\n  @Patch()\n  editBookmarkById(\n    @GetUser('id') userId: number,\n    @Body() dto: EditBookmarkDto\n  ) {\n    //\n  }\n\n  @Delete(':id')\n  deleteBookmarkById(\n    @GetUser('id') userId: number,\n    @Param('id', ParseIntPipe) bookmarkId: number\n  ) {\n    //\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \ucee8\ud2b8\ub864\ub7ec\ub97c \uc900\ube44\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"id\ub294 \uc704\uc640 \uac19\uc740 \ubc29\uc2dd\uc73c\ub85c url\uc5d0 \uc804\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\nimport { CreateBookmarkDto, EditBookmarkDto } from './dto';\n\n@Injectable()\nexport class BookmarkService {\n  getBookmarks(userId: number) {\n    //\n  }\n\n  getBookmarkById(userId: number, bookmarkId: number) {\n    //\n  }\n\n  createBookmark(userId: number, dto: CreateBookmarkDto) {\n    //\n  }\n\n  editBookmarkById(userId: number, bookmarkId: number, dto: EditBookmarkDto) {\n    //\n  }\n\n  deleteBookmarkById(userId: number, bookmarkId: number) {\n    //\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub807\uac8c \uc11c\ube44\uc2a4\uc5d0 \ud568\uc218 \uc2dc\uadf8\ub2c8\ucc98\ub97c \uc815\uc758\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  Param,\n  ParseIntPipe,\n  Patch,\n  Post,\n  UseGuards,\n} from '@nestjs/common';\nimport { JwtGuard } from 'src/auth/guard';\nimport { BookmarkService } from './bookmark.service';\nimport { GetUser } from 'src/auth/decorator';\nimport { CreateBookmarkDto, EditBookmarkDto } from './dto';\n\n@UseGuards(JwtGuard)\n@Controller('bookmark')\nexport class BookmarkController {\n  constructor(private bookmarkService: BookmarkService) {}\n  @Get()\n  getBookmarks(@GetUser('id') userId: number) {\n    return this.bookmarkService.getBookmarks(userId);\n  }\n\n  @Get(':id')\n  getBookmarkById(\n    @GetUser('id') userId: number,\n    @Param('id', ParseIntPipe) bookmarkId: number\n  ) {\n    return this.bookmarkService.getBookmarkById(userId, bookmarkId);\n  }\n\n  @Post()\n  createBookmark(\n    @GetUser('id') userId: number,\n    @Body() dto: CreateBookmarkDto\n  ) {\n    return this.bookmarkService.createBookmark(userId, dto);\n  }\n\n  @Patch(':id')\n  editBookmarkById(\n    @GetUser('id') userId: number,\n    @Param('id', ParseIntPipe) bookmarkId: number,\n    @Body() dto: EditBookmarkDto\n  ) {\n    return this.bookmarkService.editBookmarkById(userId, bookmarkId, dto);\n  }\n\n  @Delete(':id')\n  deleteBookmarkById(\n    @GetUser('id') userId: number,\n    @Param('id', ParseIntPipe) bookmarkId: number\n  ) {\n    return this.bookmarkService.deleteBookmarkById(userId, bookmarkId);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uc5ec\uae30\uae4c\uc9c0 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4."})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>i});var s=r(67294);const t={},o=s.createContext(t);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);