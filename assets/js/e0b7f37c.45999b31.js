"use strict";(self.webpackChunkarch_spatula_github_io=self.webpackChunkarch_spatula_github_io||[]).push([[3522],{92348:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var s=o(85893),r=o(11151);const t={title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",authors:["arch-spatula"],tags:["deno","mongoDB","error log"],description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",toc_max_heading_level:6},l="\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",a={permalink:"/blog/2023/05/25/",editUrl:"https://github.com/arch-spatula/arch-spatula.github.io/blob/dev/blog/2023-05-25.md",source:"@site/blog/2023-05-25.md",title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",date:"2023-05-25T00:00:00.000Z",formattedDate:"2023\ub144 5\uc6d4 25\uc77c",tags:[{label:"deno",permalink:"/blog/tags/deno"},{label:"mongoDB",permalink:"/blog/tags/mongo-db"},{label:"error log",permalink:"/blog/tags/error-log"}],readingTime:5.335,hasTruncateMarker:!0,authors:[{name:"arch-spatula",title:"Cook-Book \ub9ce\uc774 \ub9cc\ub4ed\ub2c8\ub2e4",url:"https://github.com/arch-spatula",imageURL:"https://github.com/arch-spatula.png",key:"arch-spatula"}],frontMatter:{title:"\uc5d0\ub7ec\ub85c\uadf8: Connection was forcibly closed by a peer",authors:["arch-spatula"],tags:["deno","mongoDB","error log"],description:"\uc2f1\uae00\ud2bc \ud328\ud134\uc774 \uc801\ub2f9\ud574\ubcf4\uc5ec\uc11c \ud65c\uc6a9\ud588\uc2b5\ub2c8\ub2e4.",toc_max_heading_level:6},unlisted:!1,prevItem:{title:"\uc5d0\ub7ec\ub85c\uadf8: deno deploy\uc5d0\uc11c\ub294 Worker API\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.",permalink:"/blog/2023/05/27/"},nextItem:{title:"\ud1a0\ud070 \uc2f1\uae00\ud2bc",permalink:"/blog/2023/05/23/token-singleton"}},c={authorsImageUrls:[void 0]},d=[{value:"\ubb38\uc81c: Connection was forcibly closed by a peer",id:"\ubb38\uc81c-connection-was-forcibly-closed-by-a-peer",level:2},{value:"\uc2dc\ub3c4: MongoAPI\uac00 \ubb38\uc81c\uc778\uac00?",id:"\uc2dc\ub3c4-mongoapi\uac00-\ubb38\uc81c\uc778\uac00",level:2},{value:"\uac00\uc124: MongoAPI \uba54\uc11c\ub4dc\uc5d0 \ubb38\uc81c\uac00 \uc788\uc2b5\ub2c8\ub2e4.",id:"\uac00\uc124-mongoapi-\uba54\uc11c\ub4dc\uc5d0-\ubb38\uc81c\uac00-\uc788\uc2b5\ub2c8\ub2e4",level:3},{value:"\uac31\uc2e0\uc740 \uc815\uc0c1\ub3d9\uc791",id:"\uac31\uc2e0\uc740-\uc815\uc0c1\ub3d9\uc791",level:3},{value:"\uac00\uc124: DB \uc11c\ubc84 \ubcf4\uc548\ubb38\uc81c",id:"\uac00\uc124-db-\uc11c\ubc84-\ubcf4\uc548\ubb38\uc81c",level:3},{value:"\ud574\uacb0: Deno oak\uc5d0\uc11c delete\uc758 response body\ub294 null\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.",id:"\ud574\uacb0-deno-oak\uc5d0\uc11c-delete\uc758-response-body\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",level:2},{value:"\ud559\uc2b5: deno oak\uc5d0\uc11c delete\uc758 <code>response.body</code>\ub294 <code>null</code>\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.",id:"\ud559\uc2b5-deno-oak\uc5d0\uc11c-delete\uc758-responsebody\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",level:2},{value:"\ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\uc5ed",id:"\ubc31\uc5d4\ub4dc-\uc5d4\uc9c0\ub2c8\uc5b4\uc758-\uace0\uc5ed",level:2}];function i(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\ud639\uc2dc\ub098 \ud588\ub294\ub370 \uc5ed\uc2dc\ub098 \uacaa\uc740 \ubb38\uc81c\uc785\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(n.p,{children:["tl;dr : deno oak\uc5d0\uc11c delete\uc758 ",(0,s.jsx)(n.code,{children:"response.body"}),"\ub294 ",(0,s.jsx)(n.code,{children:"null"}),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.h2,{id:"\ubb38\uc81c-connection-was-forcibly-closed-by-a-peer",children:"\ubb38\uc81c: Connection was forcibly closed by a peer"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\uc11c\ubc84\ub97c \uad6c\ub3d9\ud558\uace0 \uc0ad\uc81c\uc694\uccad\uc744 \ubcf4\ub0b4\uba74 ",(0,s.jsx)(n.code,{children:"Connection was forcibly closed by a peer"}),"\uc774\ub77c\uace0 \uc751\ub2f5\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Connection was forcibly closed by a peer"})," \uc751\ub2f5\uc744 \ubc1b\uc740 \uc774\ud6c4\ubd80\ud130\ub294 MongoDB Atlas\uc5d0\uc11c\ub294 \ub2e4\ub978 \uc694\uccad\uc744 \uac70\ubd80\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\uc2dc\ub3c4-mongoapi\uac00-\ubb38\uc81c\uc778\uac00",children:"\uc2dc\ub3c4: MongoAPI\uac00 \ubb38\uc81c\uc778\uac00?"}),"\n",(0,s.jsx)(n.h3,{id:"\uac00\uc124-mongoapi-\uba54\uc11c\ub4dc\uc5d0-\ubb38\uc81c\uac00-\uc788\uc2b5\ub2c8\ub2e4",children:"\uac00\uc124: MongoAPI \uba54\uc11c\ub4dc\uc5d0 \ubb38\uc81c\uac00 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { config } from 'https://deno.land/x/dotenv@v3.2.2/mod.ts';\nimport CardRecord from '../model/cards.ts';\n\nclass MongoAPI {\n  async deleteCards($oid: string) {\n    try {\n      const result = await fetch(`${this.baseURL}/deleteOne`, {\n        ...this.options,\n        body: JSON.stringify({\n          ...this.cardBody,\n          filter: { _id: { $oid } },\n        }),\n      });\n      return result.json();\n    } catch (error) {\n      return error;\n    }\n  }\n}\n\ntry {\n  const mongoAPI = MongoAPI.getInstance();\n  console.log(await mongoAPI.deleteCards('\uc5b4\ub5a4 id'));\n} catch (error) {\n  console.log(error);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"MongoAPI\uc5d0\uc11c \uc0ad\uc81c \ubaa8\ub4c8\ub97c \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ud588\ub294\ub370 \ubb38\uc81c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h3,{id:"\uac31\uc2e0\uc740-\uc815\uc0c1\ub3d9\uc791",children:"\uac31\uc2e0\uc740 \uc815\uc0c1\ub3d9\uc791"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function updateCard(ctx: Context) {\n  const { request, response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    if (!request.hasBody) throw Error('No Data');\n\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    const userId = await token.tokenToUserId(jwt);\n    if (!userId) throw Error('\uc0ac\uc6a9\uc790 id\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    const { question, answer, submitDate, stackCount } = await request.body()\n      .value;\n    if (!question || !answer || !submitDate || !stackCount)\n      throw Error('question, answer, data, stackCount \uc911 \uac12\uc774 1\uac1c \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    const card = new CardRecord(\n      question,\n      answer,\n      submitDate,\n      stackCount,\n      userId,\n      id\n    );\n\n    response.status = 200;\n    response.body = await mongoAPI.patchCards(card);\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\uac31\uc2e0\uc740 body\uac00 \ud544\uc694\ud55c\ub370 \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc delete\ub294 body\uac00 \ub531\ud788 \ud544\uc694\ud55c \uba54\uc11c\ub4dc\ub294 \uc544\ub2d9\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function deleteCard(ctx: Context) {\n  const { response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    const userId = await token.tokenToUserId(jwt);\n    if (!userId) throw Error('\uc0ac\uc6a9\uc790 id\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.');\n\n    response.status = 204;\n    response.body = await mongoAPI.deleteCards(id);\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\uac00\uc124-db-\uc11c\ubc84-\ubcf4\uc548\ubb38\uc81c",children:"\uac00\uc124: DB \uc11c\ubc84 \ubcf4\uc548\ubb38\uc81c"}),"\n",(0,s.jsx)(n.p,{children:"\uac00\uc124: \ubcf4\uc548\ubb38\uc81c\ub85c \ud2b9\uc815 \uc694\uccad\uc5d0 \ub300\ud574\uc11c \uc124\uc815\uc744 \ud480\uc5b4\uc918\uc57c \ud55c\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc DB \uc11c\ubc84\uc5d0\uc11c \ubcf4\uc548\ubb38\uc81c\uac00 \uc788\uc5c8\uc73c\uba74 \ub3c5\ub9bd\uc801\uc778 \ubaa8\ub4c8\ub85c \ud1b5\uc2e0\ud560 \ub54c\ubd80\ud130 \uc694\uccad \uac70\uc808\uc774 \ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ubb38\uc81c\uac00 \uc5c6\uc5c8\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"\ud574\uacb0-deno-oak\uc5d0\uc11c-delete\uc758-response-body\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",children:"\ud574\uacb0: Deno oak\uc5d0\uc11c delete\uc758 response body\ub294 null\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function deleteCard(ctx: Context) {\n  const { response, cookies } = ctx;\n  const { id } = helpers.getQuery(ctx, { mergeParams: true });\n  try {\n    const jwt = await cookies.get('user');\n    if (!jwt) {\n      throw Error('\uc778\uc99d\uc774 \uc548 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.');\n    }\n\n    response.status = 204;\n    const msg = await mongoAPI.deleteCards(id);\n    console.log(msg);\n    response.body = null;\n  } catch (error) {\n    response.status = 400;\n    response.body = {\n      success: false,\n      msg: `${error}`,\n    };\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\uc774\ub807\uac8c \uc791\uc131\ud558\ub2c8\uae4c \ud574\uacb0\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc989 ",(0,s.jsx)(n.code,{children:"response.body = null"}),"\ub85c \uc791\uc131\ud558\uba74 \uc0ad\uc81c \uad6c\ud604\uc774 \ub429\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(n.h2,{id:"\ud559\uc2b5-deno-oak\uc5d0\uc11c-delete\uc758-responsebody\ub294-null\ub85c-\uace0\uc815\ub418\uc5b4-\uc788\uc2b5\ub2c8\ub2e4",children:["\ud559\uc2b5: deno oak\uc5d0\uc11c delete\uc758 ",(0,s.jsx)(n.code,{children:"response.body"}),"\ub294 ",(0,s.jsx)(n.code,{children:"null"}),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["deno oak\uc5d0\uc11c delete\uc758 ",(0,s.jsx)(n.code,{children:"response.body"}),"\ub294 ",(0,s.jsx)(n.code,{children:"null"}),"\ub85c \uace0\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.li,{children:"\ub514\ubc84\uae45\ud560 \ub54c\ub294 \uae30\ub85d\ud558\uba74\uc11c \uac00\uc124\uc744 \uc798 \uc124\uc815\ud558\uba74 \ud6a8\uc728\uc801\uc785\ub2c8\ub2e4. \ubb34\uc5c7\uc774 \uc544\ub2cc\uc9c0 \uc18c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uace0\uae09\uc2a4\ub7ec\uc6b4 \ud45c\ud604\uc744 \uc0ac\uc6a9\ud558\uba74 \ubc84\uadf8 \ubc1c\uc6d0\uc9c0\uc758 \uba74\uc801\uc744 \ucd95\uc18c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.li,{children:"\uc5d0\ub7ec\uba54\uc2dc\uc9c0\ub294 \uccab\uc904\uc5d0 \ud56d\uc0c1 \uc8fc\uc758\ud569\uc2dc\ub2e4."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"[uncaught application error]: TypeError - Response with null body status cannot have body"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\uc774\ub7f0 \uba54\uc2dc\uc9c0\ub97c \ubd24\ub294\ub370 \ub098\uc911\uc5d0 \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.h2,{id:"\ubc31\uc5d4\ub4dc-\uc5d4\uc9c0\ub2c8\uc5b4\uc758-\uace0\uc5ed",children:"\ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\uc5ed"}),"\n",(0,s.jsx)(n.p,{children:"\ud30c\uc77c\uc744 \ubcc0\uacbd\ud558\uace0 API\ub97c \uba54\ub274\uc5bc \ud14c\uc2a4\ud2b8\ud560 \ub54c cookie\ub97c \uc0c8\ub85c \ub9cc\ub4e4\uc5b4\uc57c \ud55c\ub2e4\ub294 \ubc31\uc5d4\ub4dc \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \uace0\ud1b5\uc744 \uacf5\uac10\ud560 \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. \uc694\uccad\uc751\ub2f5 \uc2dc\uac04\uc774 3\ucd08\ub9cc \ub118\uaca8\ub3c4 \uc5c4\uccad\ub09c \uc138\uc6d4\uc774 \ud750\ub978 \ub290\ub08c\uc774\uc5c8\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(n.p,{children:"\ub2e4\ub978 \uace0\uc5ed\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \ucf54\ub4dc \uc791\uc131\uc785\ub2c8\ub2e4. Deno\ub97c \ud14c\uc2a4\ud2b8\ud558\ub294 \ubc29\ubc95\uc774 \uc775\uc219\ud558\uc9c0 \uc54a\uc544\uc11c \uadf8\ub7f0 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \uc775\uc219\ud574\uc9c0\uba74 \uc27d\uac8c \ud574\uacb0\ud560 \uc218 \uc788\uc744 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \uc77c\ubd80 \ub3d9\uc791\ud558\ub294 \ud14c\uc2a4\ud2b8\ub3c4 \uc788\uc9c0\ub9cc \uc77c\ubd80 \uc791\uc131\uc5d0 \uc2e4\ud328\ud55c \ud14c\uc2a4\ud2b8\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\ub978 \ud504\ub85c\uc81d\ud2b8 \uc9c4\ud589\ud558\uba74\uc11c \ud559\uc2b5\ud560 \uc218 \uc788\uc744 \uac83 \uac19\uc2b5\ub2c8\ub2e4."})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>a,a:()=>l});var s=o(67294);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);